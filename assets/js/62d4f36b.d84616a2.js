"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3678],{5511:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>p});var n=t(4848),s=t(8453);const a={title:"Http Trigger V4",description:"See more about how to integrate with Azure Http Trigger V4"},i=void 0,o={id:"main/adapters/azure/http-trigger-v4",title:"Http Trigger V4",description:"See more about how to integrate with Azure Http Trigger V4",source:"@site/docs/main/adapters/azure/http-trigger-v4.mdx",sourceDirName:"main/adapters/azure",slug:"/main/adapters/azure/http-trigger-v4",permalink:"/docs/main/adapters/azure/http-trigger-v4",draft:!1,unlisted:!1,editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/docs/main/adapters/azure/http-trigger-v4.mdx",tags:[],version:"current",frontMatter:{title:"Http Trigger V4",description:"See more about how to integrate with Azure Http Trigger V4"},sidebar:"main",previous:{title:"Azure",permalink:"/docs/category/azure"},next:{title:"Digital Ocean",permalink:"/docs/category/digital-ocean"}},d={},p=[{value:"Requirements",id:"requirements",level:2},{value:"About the adapter",id:"about-the-adapter",level:2},{value:"Customizing",id:"customizing",level:2},{value:"Usage",id:"usage",level:2},{value:"Credits",id:"credits",level:2}];function c(e){const r={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.admonition,{title:"Attention",type:"caution",children:(0,n.jsxs)(r.p,{children:["Check the ",(0,n.jsx)(r.a,{href:"../../handlers/azure",children:"AzureHandler"})," docs to make sure you have all the necessary settings to work with this adapter."]})}),"\n",(0,n.jsxs)(r.p,{children:["The adapter to handle requests from ",(0,n.jsx)(r.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-http-webhook-trigger?tabs=in-process%2Cfunctionsv2&pivots=programming-language-javascript",children:"Azure Http Trigger V4"}),"."]}),"\n",(0,n.jsx)(r.admonition,{type:"info",children:(0,n.jsxs)(r.p,{children:["When an error is thrown during forwarding and the ",(0,n.jsx)(r.code,{children:"responseWithErrors"})," option is ",(0,n.jsx)(r.code,{children:"true"}),", we return a 500 status WITH error stack in the response."]})}),"\n",(0,n.jsx)(r.h2,{id:"requirements",children:"Requirements"}),"\n",(0,n.jsxs)(r.p,{children:["This adapter was created to work with runtine 4.x, ",(0,n.jsx)(r.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/functions-versions?tabs=azure-cli%2Cin-process%2Cv4&pivots=programming-language-javascript#changing-version-of-apps-in-azure",children:"see the docs"}),"\r\nto know more about how to check and change the version if you need."]}),"\n",(0,n.jsx)(r.p,{children:"In theory, this adapter works with runtime 3.x but I haven't tested it."}),"\n",(0,n.jsx)(r.h2,{id:"about-the-adapter",children:"About the adapter"}),"\n",(0,n.jsx)(r.p,{children:"This adapter transforms every request coming from Azure Http Trigger V4 into an HTTP request to your framework."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-json",metastring:'title="azure-http-trigger-event-example.json"',children:'{\r\n  "method":"POST",\r\n  "url":"https://serverless-adapter.azurewebsites.net/api/test-serverless-adapter/events?code=sE_d8h7XJ4YYsGJ7mgVta_t-32323%253D%253D",\r\n  "headers":{\r\n    "accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",\r\n    "accept-encoding":"gzip, deflate, br",\r\n    "accept-language":"pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7,bg;q=0.6",\r\n    "cache-control":"max-age=0",\r\n    "host":"serverless-adapter.azurewebsites.net",\r\n    "user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36",\r\n    "sec-ch-ua":"\\".Not/A)Brand\\";v=\\"99\\", \\"Google Chrome\\";v=\\"103\\", \\"Chromium\\";v=\\"103\\"",\r\n    "sec-ch-ua-mobile":"?0",\r\n    "sec-ch-ua-platform":"\\"Linux\\"",\r\n    "client-ip":"2.3.3.3:30750",\r\n    "x-forwarded-proto":"https",\r\n    "x-appservice-proto":"https",\r\n    "x-arr-ssl":"2048|256|CN=Microsoft Azure TLS Issuing CA 01, O=Microsoft Corporation, C=US|CN=*.azurewebsites.net, O=Microsoft Corporation, L=Redmond, S=WA, C=US",\r\n    "x-forwarded-tlsversion":"1.2",\r\n    "x-forwarded-for":"3.3.3.3:49196",\r\n    "x-original-url":"/api/test-serverless-adapter?code=sE_d8h7XJ4YYsGJ7mgVta_t-32323%3D%3D",\r\n    "x-waws-unencoded-url":"/api/test-serverless-adapter?code=sE_d8h7XJ4YYsGJ7mgVta_t-32323%3D%3D",\r\n    "disguised-host":"serverless-adapter.azurewebsites.net"\r\n  },\r\n  "query":{\r\n    "code":"sE_d8h7XJ4YYsGJ7mgVta_t-32323%3D%3D"\r\n  },\r\n  "params":{},\r\n  "body":{\r\n    "name":"H4ad Event"\r\n  },\r\n  "rawBody":"{\\"name\\":\\"H4ad Event\\"}",\r\n  "user":null\r\n}\n'})}),"\n",(0,n.jsxs)(r.p,{children:["So, to add support to the above request, we must have registered the ",(0,n.jsx)(r.code,{children:"/api/test-serverless-adapter/events"})," route as ",(0,n.jsx)(r.code,{children:"POST"})," and when Http Trigger sends this event, you will get:"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"body"}),": ",(0,n.jsx)(r.code,{children:'{"name":"H4ad Event"}'})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"queryString"}),": ",(0,n.jsx)(r.code,{children:"code=sE_d8h7XJ4YYsGJ7mgVta_t-32323%3D%3D"})]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"customizing",children:"Customizing"}),"\n",(0,n.jsxs)(r.p,{children:["You can strip base path with the option ",(0,n.jsx)(r.code,{children:"stripBasePath"})," inside ",(0,n.jsx)(r.a,{href:"/docs/api/Adapters/Azure/HttpTriggerV4Adapter/HttpTriggerV4AdapterOptions",children:"HttpTriggerV4AdapterOptions"}),"."]}),"\n",(0,n.jsx)(r.admonition,{type:"tip",children:(0,n.jsxs)(r.p,{children:["You can configure this option based on your api base url like: ",(0,n.jsx)(r.code,{children:"/api/test-serverless-adapter"}),", then the request coming from ",(0,n.jsx)(r.code,{children:"/api/test-serverless-adapter/events"}),"\r\nwill be transformed into ",(0,n.jsx)(r.code,{children:"/events"}),"."]})}),"\n",(0,n.jsx)(r.h2,{id:"usage",children:"Usage"}),"\n",(0,n.jsx)(r.p,{children:"To add support to Azure Http Trigger you do the following:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'title="index.ts"',children:"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\r\nimport { AzureHandler } from '@h4ad/serverless-adapter/handlers/azure';\r\nimport { PromiseResolver } from '@h4ad/serverless-adapter/resolvers/promise';\r\nimport { HttpTriggerV4Adapter } from '@h4ad/serverless-adapter/adapters/azure';\r\nimport app from './app';\r\n\r\nexport const handler = ServerlessAdapter.new(app)\r\n  .setHandler(new AzureHandler())\r\n  // .setFramework(new ExpressFramework())\r\n  .setResolver(new PromiseResolver())\r\n  .addAdapter(new HttpTriggerV4Adapter())\r\n  // customizing:\r\n  // .addAdapter(new HttpTriggerV4Adapter({ stripBasePath: '/api/test-serverless-adapter' }))\r\n  .build();\n"})}),"\n",(0,n.jsx)(r.admonition,{type:"caution",children:(0,n.jsxs)(r.p,{children:["You MUST use the ",(0,n.jsx)(r.a,{href:"../../resolvers/promise",children:"PromiseResolver"})," combined with ",(0,n.jsx)(r.a,{href:"../../handlers/azure",children:"AzureHandler"})," to make this adapter work."]})}),"\n",(0,n.jsx)(r.h2,{id:"credits",children:"Credits"}),"\n",(0,n.jsxs)(r.p,{children:["This handler was created inspired by code written by ",(0,n.jsx)(r.a,{href:"https://github.com/Shamshiel",children:"@Shamshiel"})," and ",(0,n.jsx)(r.a,{href:"https://github.com/zachabney",children:"@zachabney"}),",\r\nthank you very much to them!"]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>i,x:()=>o});var n=t(6540);const s={},a=n.createContext(s);function i(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);