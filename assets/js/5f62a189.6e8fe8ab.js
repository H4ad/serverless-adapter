"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[474],{3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=n.createContext({}),p=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},l=function(e){var t=p(e.components);return n.createElement(d.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,d=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(a),c=r,h=u["".concat(d,".").concat(c)]||u[c]||m[c]||o;return a?n.createElement(h,i(i({ref:t},l),{},{components:a})):n.createElement(h,i({ref:t},l))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=c;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},7342:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={title:"Lambda@Edge",description:"See more about how to integrate with AWS Lambda@Edge."},i=void 0,s={unversionedId:"main/adapters/aws/lambda-edge",id:"main/adapters/aws/lambda-edge",title:"Lambda@Edge",description:"See more about how to integrate with AWS Lambda@Edge.",source:"@site/docs/main/adapters/aws/lambda-edge.mdx",sourceDirName:"main/adapters/aws",slug:"/main/adapters/aws/lambda-edge",permalink:"/docs/main/adapters/aws/lambda-edge",draft:!1,editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/docs/main/adapters/aws/lambda-edge.mdx",tags:[],version:"current",frontMatter:{title:"Lambda@Edge",description:"See more about how to integrate with AWS Lambda@Edge."},sidebar:"main",previous:{title:"Function URLs",permalink:"/docs/main/adapters/aws/function-url"},next:{title:"S3",permalink:"/docs/main/adapters/aws/s3"}},d={},p=[{value:"RequestLambdaEdgeAdapter",id:"requestlambdaedgeadapter",level:2},{value:"Customizing",id:"customizing",level:3},{value:"How to use",id:"how-to-use",level:3},{value:"Caution with limits",id:"caution-with-limits",level:3},{value:"<code>viewer request</code> or <code>source request</code>?",id:"viewer-request-or-source-request",level:3},{value:"Cache",id:"cache",level:3},{value:"LambdaEdgeAdapter",id:"lambdaedgeadapter",level:2}],l={toc:p},u="wrapper";function m(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The adapter to handle requests from ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/lambda-at-the-edge.html"},"AWS Lambda@Edge"),"."),(0,r.kt)("p",null,"We have two implementations that works with Lambda@Edge:"),(0,r.kt)("h2",{id:"requestlambdaedgeadapter"},"RequestLambdaEdgeAdapter"),(0,r.kt)("p",null,"This is the most useful implementation as it allows you to return a response during ",(0,r.kt)("inlineCode",{parentName:"p"},"viewer-request")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"origin-request")," events.\nAlso, this means that you cannot use this adapter to handle ",(0,r.kt)("inlineCode",{parentName:"p"},"viewer-response")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"origin-response")," events."),(0,r.kt)("p",null,"In short, it works like when you deploy your code using Vercel and you have an ",(0,r.kt)("inlineCode",{parentName:"p"},"api")," folder, but instead of being deployed to Vercel, it is deployed to Lambda@Edge."),(0,r.kt)("h3",{id:"customizing"},"Customizing"),(0,r.kt)("p",null,"You can remove the base path with the ",(0,r.kt)("inlineCode",{parentName:"p"},"stripBasePath")," option inside ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/Adapters/AWS/RequestLambdaEdgeAdapter/RequestLambdaEdgeAdapterOptions"},"RequestLambdaEdgeAdapterOptions"),"."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"When configuring your API with some ",(0,r.kt)("inlineCode",{parentName:"p"},"basePath")," such as ",(0,r.kt)("inlineCode",{parentName:"p"},"/api"),", you must send the request on path ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/my/path")," or set ",(0,r.kt)("inlineCode",{parentName:"p"},"stripBasePath")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"/api"),".")),(0,r.kt)("h3",{id:"how-to-use"},"How to use"),(0,r.kt)("p",null,"To add support to AWS Lambda@Edge you do the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="index.ts"',title:'"index.ts"'},"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\nimport { RequestLambdaEdgeAdapter } from '@h4ad/serverless-adapter/lib/adapters/aws';\nimport { DefaultHandler } from '@h4ad/serverless-adapter/lib/handlers/default';\nimport app from './app';\n\nexport const handler = ServerlessAdapter.new(app)\n  .setHandler(new DefaultHandler())\n  // .setFramework(new ExpressFramework())\n  // .setResolver(new PromiseResolver())\n  .addAdapter(new RequestLambdaEdgeAdapter())\n  // customizing:\n  // .addAdapter(new RequestLambdaEdgeAdapter({ stripBasePath: '/api' }))\n  .build();\n")),(0,r.kt)("h3",{id:"caution-with-limits"},"Caution with limits"),(0,r.kt)("p",null,"AWS Lambda@Edge has some limits, and one of them is response size, which is 1MB for ",(0,r.kt)("inlineCode",{parentName:"p"},"origin-request")," and 40KB for ",(0,r.kt)("inlineCode",{parentName:"p"},"viewer-request"),", ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/edge-functions-restrictions.html"},"see more here"),"."),(0,r.kt)("h3",{id:"viewer-request-or-source-request"},(0,r.kt)("inlineCode",{parentName:"h3"},"viewer request")," or ",(0,r.kt)("inlineCode",{parentName:"h3"},"source request"),"?"),(0,r.kt)("p",null,"I personally prefer using ",(0,r.kt)("inlineCode",{parentName:"p"},"origin-request")," because it can return a larger response, plus you can configure the cache behavior to cache the response, which is not possible with ",(0,r.kt)("inlineCode",{parentName:"p"},"viewer-request"),"."),(0,r.kt)("h3",{id:"cache"},"Cache"),(0,r.kt)("p",null,"As I mentioned above, you can cache the response when using ",(0,r.kt)("inlineCode",{parentName:"p"},"origin-request"),", the only problem if you set the default cache option it will cache everything!"),(0,r.kt)("p",null,"You can control the cache timing by setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"cache-control")," header, but for ",(0,r.kt)("inlineCode",{parentName:"p"},"GET")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"HEAD")," requests, even with ",(0,r.kt)("inlineCode",{parentName:"p"},"no-store")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"no-cache")," set in ",(0,r.kt)("inlineCode",{parentName:"p"},"cache-control"),", if you send the request fast enough it will return the value from the cache."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"POST"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE"),", etc... methods are not cached, so don't worry about them."),(0,r.kt)("p",null,"In resume, you can cache the response, but you need to know what you want to do and also understand how to set the cache switch correctly, so ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/ConfiguringCaching.html"},"read the docs"),"."),(0,r.kt)("h2",{id:"lambdaedgeadapter"},"LambdaEdgeAdapter"),(0,r.kt)("p",null,"Honestly, I added this adapter because @vendia/serverless-adapter had already added support for Lambda Edge, but reading my implementation and @vendia's implementation, I never knew if it actually worked because I didn't test it on AWS."),(0,r.kt)("p",null,"So at the moment I'm not going to create any documentation and feel free to test this adapter and see how it behaves."),(0,r.kt)("p",null,"You can read the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/H4ad/serverless-adapter/blob/main/src/adapters/aws/lambda-edge.adapter.ts"},"source code here")," to see how the request and response are being assembled, as well as take a look at ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/Adapters/AWS/LambdaEdgeAdapter/LambdaEdgeAdapterOptions"},"LambdaEdgeAdapterOptions")," to see what options you can pass."),(0,r.kt)("p",null,"Despite being lazy to create Lambda Edge documentation, in the code I tried to add as many comments as possible to explain each option."))}m.isMDXComponent=!0}}]);