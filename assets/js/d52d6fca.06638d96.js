"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3309],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>m});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(r),m=a,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||o;return r?n.createElement(h,i(i({ref:t},u),{},{components:r})):n.createElement(h,i({ref:t},u))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},8970:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=r(7462),a=(r(7294),r(3905));const o={title:"Huawei",description:"See more about how to integrate with Huawei."},i=void 0,s={unversionedId:"main/handlers/huawei",id:"main/handlers/huawei",title:"Huawei",description:"See more about how to integrate with Huawei.",source:"@site/docs/main/handlers/huawei.mdx",sourceDirName:"main/handlers",slug:"/main/handlers/huawei",permalink:"/serverless-adapter/docs/main/handlers/huawei",draft:!1,editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/docs/main/handlers/huawei.mdx",tags:[],version:"current",frontMatter:{title:"Huawei",description:"See more about how to integrate with Huawei."},sidebar:"main",previous:{title:"Firebase",permalink:"/serverless-adapter/docs/main/handlers/firebase"},next:{title:"Resolvers",permalink:"/serverless-adapter/docs/category/resolvers"}},l={},p=[{value:"Http Function",id:"http-function",level:2},{value:"Event Function",id:"event-function",level:2},{value:"Examples",id:"examples",level:2},{value:"Sponsor",id:"sponsor",level:2}],u={toc:p};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In Huawei, we added support to FunctionGraphV2 with Http Function and Event Function."),(0,a.kt)("p",null,"The difference between Http Function and Event Function is that in Http Function you must expose port 8000 and Huawei will proxy Api Gateway requests to your application.\nSo, on implementation, this library will create an http server to listen on port 8000 and forward the request to your framework."),(0,a.kt)("p",null,"In Event Function, you will receive the event from event source in the same way you receive in AWS, an object with some structure, you can see the supported event sources ",(0,a.kt)("a",{parentName:"p",href:"https://support.huaweicloud.com/intl/en-us/devg-functiongraph/functiongraph_02_0102.html"},"here"),"."),(0,a.kt)("h2",{id:"http-function"},"Http Function"),(0,a.kt)("p",null,"To integrate your app with Huawei FunctionGrapth with the Http Function type, you must do the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\nimport { ExpressFramework } from '@h4ad/serverless-adapter/lib/frameworks/express';\nimport { HttpHuaweiHandler } from '@h4ad/serverless-adapter/lib/handlers/huawei';\nimport { DummyResolver } from '@h4ad/serverless-adapter/lib/resolvers/dummy';\nimport { DummyAdapter } from '@h4ad/serverless-adapter/lib/adapters/dummy';\nimport app from './app';\n\n// instead exposing handler, you have the dispose function\n// this dispose function is never called\n// but you can to close the http server created with him\nconst dispose = ServerlessAdapter.new(app)\n    .setHandler(new HttpHuaweiHandler())\n    .setFramework(new ExpressFramework())\n    // dummy resolver and adapter is used because\n    // they are necessary in the core of the library to build\n    // but is optional to make huawei http function works.\n    .setResolver(new DummyResolver())\n    .addAdapter(new DummyAdapter())\n    .build();\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"You don't need to expose a variable called ",(0,a.kt)("inlineCode",{parentName:"p"},"handler")," when you choose Http Function, you just need to call build to the library create a http server.")),(0,a.kt)("p",null,"By the way of Huawei architecture in Http Function, they have no use for Resolvers and Adapters, so you need to use the dummy versions because the library requires it."),(0,a.kt)("admonition",{title:"ONE IMPORTANT THING",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"You need to configure a file called ",(0,a.kt)("inlineCode",{parentName:"p"},"bootstrap")," in the root of folder that you upload to Huawei, is like the file ",(0,a.kt)("inlineCode",{parentName:"p"},"Procfile")," but for Huawei."),(0,a.kt)("p",{parentName:"admonition"},"In my setup, I configure like:"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre"},"node /opt/function/code/index.js\n")),(0,a.kt)("p",{parentName:"admonition"},"The path ",(0,a.kt)("inlineCode",{parentName:"p"},"/opt/function/code")," is where your code is uploaded when you deploy something and ",(0,a.kt)("inlineCode",{parentName:"p"},"index.js")," is the file that contains the ",(0,a.kt)("inlineCode",{parentName:"p"},"ServerlessAdapter"),"."),(0,a.kt)("p",{parentName:"admonition"},"In the end, the structure of the zip file you upload looks like this:"),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"bootstrap")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"index.js")))),(0,a.kt)("h2",{id:"event-function"},"Event Function"),(0,a.kt)("p",null,"With Http Function you need to use ",(0,a.kt)("a",{parentName:"p",href:"./huawei#http-function"},"HttpHuaweiHandler"),",\nbut with Event Function you should use ",(0,a.kt)("a",{parentName:"p",href:"./default"},"DefaultHandler"),"."),(0,a.kt)("p",null,"So, to add support to Api Gateway you do the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="index.ts"',title:'"index.ts"'},"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\nimport { HuaweiApiGatewayAdapter } from '@h4ad/serverless-adapter/lib/adapters/huawei';\nimport { ExpressFramework } from '@h4ad/serverless-adapter/lib/frameworks/express';\nimport { DefaultHandler } from '@h4ad/serverless-adapter/lib/handlers/default';\nimport { CallbackResolver } from '@h4ad/serverless-adapter/lib/resolvers/callback';\nimport app from './app';\n\nexport const handler = ServerlessAdapter.new(app)\n  .setFramework(new ExpressFramework())\n  .setHandler(new DefaultHandler())\n  .setResolver(new CallbackResolver())\n  .addAdapter(new HuaweiApiGatewayAdapter())\n  .build();\n")),(0,a.kt)("admonition",{title:"One important thing",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"You must use the callback resolver because I couldn't get it to work with the PromiseResolver.\nMaybe it's a bug in the library or something specific in Huawei, if you have a hint please create an issue.")),(0,a.kt)("h2",{id:"examples"},"Examples"),(0,a.kt)("p",null,"You can see examples of how to use ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/H4ad/serverless-adapter-examples"},"here"),"."),(0,a.kt)("h2",{id:"sponsor"},"Sponsor"),(0,a.kt)("p",null,"This handler was sponsored by ",(0,a.kt)("a",{parentName:"p",href:"https://liga.facens.br/"},"Liga"),", if you want to built an app, site or game (mobile, AR or VR), send an email to ","[liga@facens.br]","."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},(0,a.kt)("a",{href:"https://liga.facens.br/"},(0,a.kt)("img",{height:"50",src:"https://mlogu6g7z5ex.i.optimole.com/yEwfkqo-4R0ttNtd/w:auto/h:auto/q:mauto/f:avif/http://liga.facens.br/wp-content/uploads/2020/03/logo-1.png",title:"The LIGA logo",width:"100"})))))))}d.isMDXComponent=!0}}]);