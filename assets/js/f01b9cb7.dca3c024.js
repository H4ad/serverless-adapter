"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3214],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>c});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),s=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},d=function(e){var t=s(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),m=s(r),c=o,k=m["".concat(l,".").concat(c)]||m[c]||u[c]||a;return r?n.createElement(k,i(i({ref:t},d),{},{components:r})):n.createElement(k,i({ref:t},d))}));function c(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=m;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p.mdxType="string"==typeof e?e:o,i[1]=p;for(var s=2;s<a;s++)i[s]=r[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},7034:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>p,toc:()=>s});var n=r(7462),o=(r(7294),r(3905));const a={title:"Deepkit",description:"See more about how to integrate with deepkit."},i=void 0,p={unversionedId:"main/frameworks/deepkit",id:"main/frameworks/deepkit",title:"Deepkit",description:"See more about how to integrate with deepkit.",source:"@site/docs/main/frameworks/deepkit.mdx",sourceDirName:"main/frameworks",slug:"/main/frameworks/deepkit",permalink:"/docs/main/frameworks/deepkit",draft:!1,editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/docs/main/frameworks/deepkit.mdx",tags:[],version:"current",frontMatter:{title:"Deepkit",description:"See more about how to integrate with deepkit."},sidebar:"main",previous:{title:"CORS",permalink:"/docs/main/frameworks/cors"},next:{title:"Express",permalink:"/docs/main/frameworks/express"}},l={},s=[{value:"About AWS",id:"about-aws",level:2},{value:"FAQ",id:"faq",level:3},{value:"ERR_DLOPEN_FAILED",id:"err_dlopen_failed",level:3},{value:"ENOENT",id:"enoent",level:3}],d={toc:s};function u(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"The following examples only work with deepkit over HTTP, you cannot use this framework to support websocket or rpc.")),(0,o.kt)("p",null,"First, you need to ensure you have the libs installed, so run this code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm i --save @deepkit/app @deepkit/core @deepkit/framework @deepkit/http @deepkit/type @deepkit/type-compiler\n")),(0,o.kt)("p",null,"Then, you need you just need to use the ",(0,o.kt)("a",{parentName:"p",href:"../../api/Frameworks/HttpDeepkitFramework"},"HttpDeepkitFramework")," when you create your adapter, like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="index.ts"',title:'"index.ts"'},"import { App } from '@deepkit/app';\nimport { FrameworkModule } from '@deepkit/framework';\nimport { HtmlResponse, HttpKernel, HttpModule, HttpRouterRegistry } from '@deepkit/http';\nimport { ServerlessAdapter } from '@h4ad/serverless-adapter';\nimport { HttpDeepkitFramework } from '@h4ad/serverless-adapter/lib/frameworks/deepkit';\n\nconst app = new App({\n  controllers: [],\n  module: [\n    new HttpModule(),\n    new FrameworkModule()\n  ],\n});\n\nconst router = app.get(HttpRouterRegistry);\n\nrouter.get('/', () => {\n  return new HtmlResponse('<h1>Sample in Deepkit Project</h1>');\n});\n\nconst httpKernel = app.get(HttpKernel);\n\nexport const handler = ServerlessAdapter.new(httpKernel)\n  .setFramework(new HttpDeepkitFramework())\n  // .setHandler(new DefaultHandler())\n  // .setResolver(new PromiseResolver())\n  // .addAdapter(new AlbAdapter())\n  // .addAdapter(new SQSAdapter())\n  // .addAdapter(new SNSAdapter())\n  // after put all methods necessary, just call the build method.\n  .build();\n")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Need more examples? See more examples ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/H4ad/serverless-adapter-examples#deepkit"},"here"),".")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Is your application instance creation asynchronous? Look the ",(0,o.kt)("a",{parentName:"p",href:"./lazy"},"LazyFramework")," which helps you in asynchronous startup.")),(0,o.kt)("h2",{id:"about-aws"},"About AWS"),(0,o.kt)("p",null,"I was only able to get Deepkit working when you deploy using NodeJS 16.x and using the ",(0,o.kt)("inlineCode",{parentName:"p"},"x86_64")," architecture."),(0,o.kt)("p",null,"Also, I tried using the ",(0,o.kt)("inlineCode",{parentName:"p"},"serverless-offline")," package and it throws an error about ",(0,o.kt)("inlineCode",{parentName:"p"},"could not find handler"),", not sure why\nI changed the deployment configuration to upload code manually. So if you like to use ",(0,o.kt)("inlineCode",{parentName:"p"},"serverless framework"),", know\nthat you will have problems trying to test locally."),(0,o.kt)("h3",{id:"faq"},"FAQ"),(0,o.kt)("h3",{id:"err_dlopen_failed"},"ERR_DLOPEN_FAILED"),(0,o.kt)("p",null,"Error message: /var/task/node_modules/turbo-net/build/Release/turbo_net.node: cannot open shared object file: No such file or directory\nSolution: Change your lambda architecture to ",(0,o.kt)("inlineCode",{parentName:"p"},"x86_64"),"."),(0,o.kt)("h3",{id:"enoent"},"ENOENT"),(0,o.kt)("p",null,"Error message: no such file or directory, mkdir 'var/debug/'\nSolution:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"// change these options\nnew HttpModule({ debug: true }),\nnew FrameworkModule({ debug: true, httpLog: true }),\n// for\nnew HttpModule({ debug: false }),\nnew FrameworkModule({ debug: false, httpLog: false }),\n")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Need to deal with CORS? See ",(0,o.kt)("a",{parentName:"p",href:"./cors"},"CorsFramework")," which helps you to add correct headers.")))}u.isMDXComponent=!0}}]);