"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6032],{1156:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>t,metadata:()=>i,toc:()=>d});var r=a(4848),n=a(8453);const t={slug:"aws-lambda-response-streaming",title:"AWS Lambda Response Streaming",authors:["h4ad"],tags:["serverless-adapter","aws","aws-lambda","function-url"],image:"https://images.unsplash.com/photo-1527489377706-5bf97e608852"},o=void 0,i={permalink:"/blog/aws-lambda-response-streaming",editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/blog/2023-04-28-aws-lambda-response-streaming.mdx",source:"@site/blog/2023-04-28-aws-lambda-response-streaming.mdx",title:"AWS Lambda Response Streaming",description:"A beautiful stream!",date:"2023-04-28T00:00:00.000Z",formattedDate:"April 28, 2023",tags:[{label:"serverless-adapter",permalink:"/blog/tags/serverless-adapter"},{label:"aws",permalink:"/blog/tags/aws"},{label:"aws-lambda",permalink:"/blog/tags/aws-lambda"},{label:"function-url",permalink:"/blog/tags/function-url"}],readingTime:2.79,hasTruncateMarker:!1,authors:[{name:"Vin\xedcius Louren\xe7o",title:"Maintainer of Serverless Adapter",url:"https://github.com/h4ad",imageURL:"https://github.com/h4ad.png",key:"h4ad"}],frontMatter:{slug:"aws-lambda-response-streaming",title:"AWS Lambda Response Streaming",authors:["h4ad"],tags:["serverless-adapter","aws","aws-lambda","function-url"],image:"https://images.unsplash.com/photo-1527489377706-5bf97e608852"},unlisted:!1,prevItem:{title:"Support for Dual Package Publish",permalink:"/blog/dual-package-publish"},nextItem:{title:"Updates and Releases",permalink:"/blog/updates-and-releases"}},l={authorsImageUrls:[void 0]},d=[{value:"First, are you new to this library?",id:"first-are-you-new-to-this-library",level:2},{value:"What does this library support?",id:"what-does-this-library-support",level:3},{value:"AWS Lambda Response Streaming",id:"aws-lambda-response-streaming",level:2},{value:"I NEED CODE!!!",id:"i-need-code",level:3},{value:"Beyond HTTP Requests",id:"beyond-http-requests",level:2},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",div:"div",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{src:"https://images.unsplash.com/photo-1527489377706-5bf97e608852",alt:"A beautiful stream!"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["Image by ",(0,r.jsx)(s.a,{href:"https://unsplash.com/@the_bracketeer",children:"Hendrik Cornelissen"})," on ",(0,r.jsx)(s.a,{href:"https://unsplash.com",children:"Unsplash"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"It's been a long time since I wrote a post here, but I'm happy to share this new announcement."}),"\n",(0,r.jsx)(s.h2,{id:"first-are-you-new-to-this-library",children:"First, are you new to this library?"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"First time?",src:a(2364).A+"",width:"498",height:"280"})}),"\n",(0,r.jsxs)(s.p,{children:["Let me introduce the library first, I named ",(0,r.jsx)(s.a,{href:"/docs/main/intro",children:"Serverless Adapter"})," because my goal is connect any serverless environment to any NodeJS framework."]}),"\n",(0,r.jsxs)(s.p,{children:["So you could just plug your ",(0,r.jsx)(s.a,{href:"/docs/main/architecture#framework",children:"framework"}),", use the correct ",(0,r.jsx)(s.a,{href:"/docs/main/architecture#handler",children:"handler"})," for your serverless environment,\nchoose the ",(0,r.jsx)(s.a,{href:"/docs/main/architecture#adapter",children:"adapters"})," and then you can deploy your application!"]}),"\n",(0,r.jsx)(s.h3,{id:"what-does-this-library-support",children:"What does this library support?"}),"\n",(0,r.jsxs)(s.p,{children:["Currently, we support ",(0,r.jsx)(s.a,{href:"/docs/category/frameworks",children:"8 NodeJS frameworks"}),": ",(0,r.jsx)(s.a,{href:"/docs/main/frameworks/express",children:"Express"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/frameworks/fastify",children:"Fastify"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/frameworks/trpc",children:"tRPC"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/frameworks/apollo-server",children:"Apollo Server"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/frameworks/nestjs",children:"NestJS"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/frameworks/deepkit",children:"Deepkit"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/frameworks/koa",children:"Koa"})," and ",(0,r.jsx)(s.a,{href:"/docs/main/frameworks/Hapi",children:"Hapi"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["We also support ",(0,r.jsx)(s.a,{href:"/docs/category/handlers",children:"6 serverless environments"}),": ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/aws",children:"AWS"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/azure",children:"Azure"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/gcp",children:"Google Cloud"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/digital-ocean",children:"Digital Ocean"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/firebase",children:"Firebase"})," and ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/huawei",children:"Huawei"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["Talking about AWS, we support ",(0,r.jsx)(s.a,{href:"/docs/category/aws",children:"10 different services"})," like API Gateway ",(0,r.jsx)(s.a,{href:"/docs/main/adapters/aws/api-gateway-v1",children:"V1"})," and ",(0,r.jsx)(s.a,{href:"/docs/main/adapters/aws/api-gateway-v2",children:"V2"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/adapters/aws/sqs",children:"SQS"}),", ",(0,r.jsx)(s.a,{href:"/docs/main/adapters/aws/sns",children:"SNS"}),", etc... and you can combine them to use the same codebase and lambda to handle them all."]}),"\n",(0,r.jsx)(s.admonition,{type:"tip",children:(0,r.jsxs)(s.p,{children:["To learn understand the power of this composability, check this article I wrote about how I went ",(0,r.jsx)(s.a,{href:"https://viniciusl.com.br/posts/2022/12/08-from-million-invocations-to-thousand-with-correct-caching/",children:"From a million invocations to a thousand with correct caching"}),"."]})}),"\n",(0,r.jsx)(s.p,{children:"But okay, enough self-marketing, let's get to the main point of this article."}),"\n",(0,r.jsx)(s.h2,{id:"aws-lambda-response-streaming",children:"AWS Lambda Response Streaming"}),"\n",(0,r.jsxs)(s.p,{children:["Today I'm rolling out support for ",(0,r.jsx)(s.a,{href:"https://aws.amazon.com/blogs/compute/introducing-aws-lambda-response-streaming/",children:"AWS Lambda Streaming Response"})," using ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/aws#aws-lambda-response-streaming",children:"AwsStreamHandler"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["If you already use this library, just change ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/aws#usage",children:"DefaultHandler"})," to ",(0,r.jsx)(s.a,{href:"/docs/main/handlers/aws#aws-lambda-response-streaming",children:"AwsStreamHandler"}),", and make sure you're using ",(0,r.jsx)(s.a,{href:"/docs/api/Resolvers/DummyResolver",children:"DummyResolver"})," and ",(0,r.jsx)(s.a,{href:"/docs/main/adapters/aws/api-gateway-v2",children:"ApiGatewayV2Adapter"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",metastring:'title="index.ts"',children:"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\nimport { AwsStreamHandler } from '@h4ad/serverless-adapter/handlers/aws';\nimport { DummyResolver } from '@h4ad/serverless-adapter/resolvers/dummy';\nimport { ApiGatewayV2Adapter } from '@h4ad/serverless-adapter/adapters/aws';\nimport app from './app';\n\nexport const handler = ServerlessAdapter.new(app)\n// .setHandler(new DefaultHandler())\n   .setHandler(new AwsStreamHandler())\n   .setResolver(new DummyResolver())\n   .setAdapter(new ApiGatewayV2Adapter())\n   // more options...\n   //.setFramework(new ExpressFramework())\n   .build();\n"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["Despite its name, ",(0,r.jsx)(s.code,{children:"ApiGatewayV2Adapter"})," can be used to support API Gateway V2 and function URLs."]}),"\n"]}),"\n",(0,r.jsx)(s.admonition,{type:"caution",children:(0,r.jsx)(s.p,{children:"Response streaming currently is only available for Function URLs."})}),"\n",(0,r.jsx)(s.p,{children:"That's it :) Now you can use Function URLs and stream your content to the world!"}),"\n",(0,r.jsx)(s.div,{children:(0,r.jsxs)(s.p,{children:["Don't forget to enable the feature in your AWS Lambda function by changing ",(0,r.jsx)(s.code,{children:"BUFFERED"})," TO ",(0,r.jsx)(s.code,{children:"RESPONSE_STREAM."})]})}),"\n",(0,r.jsx)(s.h3,{id:"i-need-code",children:"I NEED CODE!!!"}),"\n",(0,r.jsxs)(s.p,{children:["Well, if you're the type of person who, like me, needs to see the code working, here's a repository with several example projects using this library:\n",(0,r.jsx)(s.a,{href:"https://github.com/H4ad/serverless-adapter-examples",children:"serverless-adapter-examples"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"beyond-http-requests",children:"Beyond HTTP Requests"}),"\n",(0,r.jsxs)(s.p,{children:["Furthermore, not only can you receive HTTP requests using ",(0,r.jsx)(s.code,{children:"Function URLs"}),", but you can combine your ",(0,r.jsx)(s.code,{children:"SQS"})," queue and use the same codebase to process everything."]}),"\n",(0,r.jsxs)(s.p,{children:["I haven't spent a lot of time testing it, but so far, any AWS service that supports this library can be hooked up to your Lambda function with ",(0,r.jsx)(s.code,{children:"RESPONSE_STREAM"})," enabled."]}),"\n",(0,r.jsxs)(s.p,{children:["The only thing you need to know is: the answer didn't work as expected, I couldn't get the ",(0,r.jsx)(s.a,{href:"/docs/main/adapters/aws/sqs#batch-item-failures",children:"SQS Partial Response"})," to work for example ."]}),"\n",(0,r.jsxs)(s.p,{children:["But you can give it a try anyway, share your results with me on ",(0,r.jsx)(s.a,{href:"https://twitter.com/vinii_joga10",children:"twitter"})," and I'll be happy to help if I can."]}),"\n",(0,r.jsx)(s.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsx)(s.p,{children:"Well, I don't have much to say, but I hope you enjoy this new feature and use it to build amazing things."}),"\n",(0,r.jsx)(s.p,{children:"I've spent the last 3 weeks trying to figure out how to make this work and I'm happy with the result."}),"\n",(0,r.jsxs)(s.p,{children:["If you're curious enough to learn more about how I implement it, you can see ",(0,r.jsx)(s.a,{href:"https://github.com/H4ad/serverless-adapter/pull/90",children:"this PR"})," with all my struggles and thoughts over the weeks."]})]})}function c(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},2364:(e,s,a)=>{a.d(s,{A:()=>r});const r=a.p+"assets/images/first-time-meme-first-time-3b9ed63592d7e85d38fb81a1dae3b345.gif"},8453:(e,s,a)=>{a.d(s,{R:()=>o,x:()=>i});var r=a(6540);const n={},t=r.createContext(n);function o(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);