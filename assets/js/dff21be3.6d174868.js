"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3401],{3905:(e,a,t)=>{t.d(a,{Zo:()=>m,kt:()=>h});var r=t(7294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var p=r.createContext({}),l=function(e){var a=r.useContext(p),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},m=function(e){var a=l(e.components);return r.createElement(p.Provider,{value:a},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},c=r.forwardRef((function(e,a){var t=e.components,n=e.mdxType,s=e.originalType,p=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),d=l(t),c=n,h=d["".concat(p,".").concat(c)]||d[c]||u[c]||s;return t?r.createElement(h,o(o({ref:a},m),{},{components:t})):r.createElement(h,o({ref:a},m))}));function h(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var s=t.length,o=new Array(s);o[0]=c;var i={};for(var p in a)hasOwnProperty.call(a,p)&&(i[p]=a[p]);i.originalType=e,i[d]="string"==typeof e?e:n,o[1]=i;for(var l=2;l<s;l++)o[l]=t[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},3067:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=t(7462),n=(t(7294),t(3905));const s={slug:"aws-lambda-response-streaming",title:"AWS Lambda Response Streaming",authors:["h4ad"],tags:["serverless-adapter","aws","aws-lambda","function-url"],image:"https://images.unsplash.com/photo-1527489377706-5bf97e608852"},o=void 0,i={permalink:"/blog/aws-lambda-response-streaming",editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/blog/2023-04-28-aws-lambda-response-streaming.mdx",source:"@site/blog/2023-04-28-aws-lambda-response-streaming.mdx",title:"AWS Lambda Response Streaming",description:"A beautiful stream!",date:"2023-04-28T00:00:00.000Z",formattedDate:"April 28, 2023",tags:[{label:"serverless-adapter",permalink:"/blog/tags/serverless-adapter"},{label:"aws",permalink:"/blog/tags/aws"},{label:"aws-lambda",permalink:"/blog/tags/aws-lambda"},{label:"function-url",permalink:"/blog/tags/function-url"}],readingTime:2.79,hasTruncateMarker:!1,authors:[{name:"Vin\xedcius Louren\xe7o",title:"Maintainer of Serverless Adapter",url:"https://github.com/h4ad",imageURL:"https://github.com/h4ad.png",key:"h4ad"}],frontMatter:{slug:"aws-lambda-response-streaming",title:"AWS Lambda Response Streaming",authors:["h4ad"],tags:["serverless-adapter","aws","aws-lambda","function-url"],image:"https://images.unsplash.com/photo-1527489377706-5bf97e608852"},nextItem:{title:"Updates and Releases",permalink:"/blog/updates-and-releases"}},p={authorsImageUrls:[void 0]},l=[{value:"First, are you new to this library?",id:"first-are-you-new-to-this-library",level:2},{value:"What does this library support?",id:"what-does-this-library-support",level:3},{value:"AWS Lambda Response Streaming",id:"aws-lambda-response-streaming",level:2},{value:"I NEED CODE!!!",id:"i-need-code",level:3},{value:"Beyond HTTP Requests",id:"beyond-http-requests",level:2},{value:"Conclusion",id:"conclusion",level:2}],m={toc:l},d="wrapper";function u(e){let{components:a,...s}=e;return(0,n.kt)(d,(0,r.Z)({},m,s,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://images.unsplash.com/photo-1527489377706-5bf97e608852",alt:"A beautiful stream!"})),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Image by ",(0,n.kt)("a",{parentName:"p",href:"https://unsplash.com/@the_bracketeer"},"Hendrik Cornelissen")," on ",(0,n.kt)("a",{parentName:"p",href:"https://unsplash.com"},"Unsplash"))),(0,n.kt)("p",null,"It's been a long time since I wrote a post here, but I'm happy to share this new announcement."),(0,n.kt)("h2",{id:"first-are-you-new-to-this-library"},"First, are you new to this library?"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"First time?",src:t(1856).Z,width:"498",height:"280"})),(0,n.kt)("p",null,"Let me introduce the library first, I named ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/intro"},"Serverless Adapter")," because my goal is connect any serverless environment to any NodeJS framework."),(0,n.kt)("p",null,"So you could just plug your ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/architecture#framework"},"framework"),", use the correct ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/architecture#handler"},"handler")," for your serverless environment,\nchoose the ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/architecture#adapter"},"adapters")," and then you can deploy your application!"),(0,n.kt)("h3",{id:"what-does-this-library-support"},"What does this library support?"),(0,n.kt)("p",null,"Currently, we support ",(0,n.kt)("a",{parentName:"p",href:"/docs/category/frameworks"},"8 NodeJS frameworks"),": ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/frameworks/express"},"Express"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/frameworks/fastify"},"Fastify"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/frameworks/trpc"},"tRPC"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/frameworks/apollo-server"},"Apollo Server"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/frameworks/nestjs"},"NestJS"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/frameworks/deepkit"},"Deepkit"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/frameworks/koa"},"Koa")," and ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/frameworks/Hapi"},"Hapi"),"."),(0,n.kt)("p",null,"We also support ",(0,n.kt)("a",{parentName:"p",href:"/docs/category/handlers"},"6 serverless environments"),": ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/aws"},"AWS"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/azure"},"Azure"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/gcp"},"Google Cloud"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/digital-ocean"},"Digital Ocean"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/firebase"},"Firebase")," and ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/huawei"},"Huawei"),"."),(0,n.kt)("p",null,"Talking about AWS, we support ",(0,n.kt)("a",{parentName:"p",href:"/docs/category/aws"},"10 different services")," like API Gateway ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/adapters/aws/api-gateway-v1"},"V1")," and ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/adapters/aws/api-gateway-v2"},"V2"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/adapters/aws/sqs"},"SQS"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/adapters/aws/sns"},"SNS"),", etc... and you can combine them to use the same codebase and lambda to handle them all."),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"To learn understand the power of this composability, check this article I wrote about how I went ",(0,n.kt)("a",{parentName:"p",href:"https://viniciusl.com.br/posts/2022/12/08-from-million-invocations-to-thousand-with-correct-caching/"},"From a million invocations to a thousand with correct caching"),".")),(0,n.kt)("p",null,"But okay, enough self-marketing, let's get to the main point of this article."),(0,n.kt)("h2",{id:"aws-lambda-response-streaming"},"AWS Lambda Response Streaming"),(0,n.kt)("p",null,"Today I'm rolling out support for ",(0,n.kt)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/compute/introducing-aws-lambda-response-streaming/"},"AWS Lambda Streaming Response")," using ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/aws#aws-lambda-response-streaming"},"AwsStreamHandler"),"."),(0,n.kt)("p",null,"If you already use this library, just change ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/aws#usage"},"DefaultHandler")," to ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/handlers/aws#aws-lambda-response-streaming"},"AwsStreamHandler"),", and make sure you're using ",(0,n.kt)("a",{parentName:"p",href:"/docs/api/Resolvers/DummyResolver"},"DummyResolver")," and ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/adapters/aws/api-gateway-v2"},"ApiGatewayV2Adapter"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="index.ts"',title:'"index.ts"'},"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\nimport { AwsStreamHandler } from '@h4ad/serverless-adapter/lib/handlers/aws';\nimport { DummyResolver } from '@h4ad/serverless-adapter/lib/resolvers/dummy';\nimport { ApiGatewayV2Adapter } from '@h4ad/serverless-adapter/lib/adapters/aws';\nimport app from './app';\n\nexport const handler = ServerlessAdapter.new(app)\n// .setHandler(new DefaultHandler())\n   .setHandler(new AwsStreamHandler())\n   .setResolver(new DummyResolver())\n   .setAdapter(new ApiGatewayV2Adapter())\n   // more options...\n   //.setFramework(new ExpressFramework())\n   .build();\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Despite its name, ",(0,n.kt)("inlineCode",{parentName:"p"},"ApiGatewayV2Adapter")," can be used to support API Gateway V2 and function URLs.")),(0,n.kt)("admonition",{type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"Response streaming currently is only available for Function URLs.")),(0,n.kt)("p",null,"That's it :) Now you can use Function URLs and stream your content to the world!"),(0,n.kt)("admonition",{title:"rmation",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Don't forget to enable the feature in your AWS Lambda function by changing ",(0,n.kt)("inlineCode",{parentName:"p"},"BUFFERED")," TO ",(0,n.kt)("inlineCode",{parentName:"p"},"RESPONSE_STREAM."))),(0,n.kt)("h3",{id:"i-need-code"},"I NEED CODE!!!"),(0,n.kt)("p",null,"Well, if you're the type of person who, like me, needs to see the code working, here's a repository with several example projects using this library:\n",(0,n.kt)("a",{parentName:"p",href:"https://github.com/H4ad/serverless-adapter-examples"},"serverless-adapter-examples"),"."),(0,n.kt)("h2",{id:"beyond-http-requests"},"Beyond HTTP Requests"),(0,n.kt)("p",null,"Furthermore, not only can you receive HTTP requests using ",(0,n.kt)("inlineCode",{parentName:"p"},"Function URLs"),", but you can combine your ",(0,n.kt)("inlineCode",{parentName:"p"},"SQS")," queue and use the same codebase to process everything."),(0,n.kt)("p",null,"I haven't spent a lot of time testing it, but so far, any AWS service that supports this library can be hooked up to your Lambda function with ",(0,n.kt)("inlineCode",{parentName:"p"},"RESPONSE_STREAM")," enabled."),(0,n.kt)("p",null,"The only thing you need to know is: the answer didn't work as expected, I couldn't get the ",(0,n.kt)("a",{parentName:"p",href:"/docs/main/adapters/aws/sqs#batch-item-failures"},"SQS Partial Response")," to work for example ."),(0,n.kt)("p",null,"But you can give it a try anyway, share your results with me on ",(0,n.kt)("a",{parentName:"p",href:"https://twitter.com/vinii_joga10"},"twitter")," and I'll be happy to help if I can."),(0,n.kt)("h2",{id:"conclusion"},"Conclusion"),(0,n.kt)("p",null,"Well, I don't have much to say, but I hope you enjoy this new feature and use it to build amazing things."),(0,n.kt)("p",null,"I've spent the last 3 weeks trying to figure out how to make this work and I'm happy with the result."),(0,n.kt)("p",null,"If you're curious enough to learn more about how I implement it, you can see ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/H4ad/serverless-adapter/pull/90"},"this PR")," with all my struggles and thoughts over the weeks."))}u.isMDXComponent=!0},1856:(e,a,t)=>{t.d(a,{Z:()=>r});const r=t.p+"assets/images/first-time-meme-first-time-3b9ed63592d7e85d38fb81a1dae3b345.gif"}}]);