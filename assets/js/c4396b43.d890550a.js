"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9134],{3905:(e,r,o)=>{o.d(r,{Zo:()=>m,kt:()=>k});var t=o(7294);function a(e,r,o){return r in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function n(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),o.push.apply(o,t)}return o}function s(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n(Object(o),!0).forEach((function(r){a(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function p(e,r){if(null==e)return{};var o,t,a=function(e,r){if(null==e)return{};var o,t,a={},n=Object.keys(e);for(t=0;t<n.length;t++)o=n[t],r.indexOf(o)>=0||(a[o]=e[o]);return a}(e,r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)o=n[t],r.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var i=t.createContext({}),l=function(e){var r=t.useContext(i),o=r;return e&&(o="function"==typeof e?e(r):s(s({},r),e)),o},m=function(e){var r=l(e.components);return t.createElement(i.Provider,{value:r},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},u=t.forwardRef((function(e,r){var o=e.components,a=e.mdxType,n=e.originalType,i=e.parentName,m=p(e,["components","mdxType","originalType","parentName"]),d=l(o),u=a,k=d["".concat(i,".").concat(u)]||d[u]||c[u]||n;return o?t.createElement(k,s(s({ref:r},m),{},{components:o})):t.createElement(k,s({ref:r},m))}));function k(e,r){var o=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var n=o.length,s=new Array(n);s[0]=u;var p={};for(var i in r)hasOwnProperty.call(r,i)&&(p[i]=r[i]);p.originalType=e,p[d]="string"==typeof e?e:a,s[1]=p;for(var l=2;l<n;l++)s[l]=o[l];return t.createElement.apply(null,s)}return t.createElement.apply(null,o)}u.displayName="MDXCreateElement"},5523:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>i,contentTitle:()=>s,default:()=>c,frontMatter:()=>n,metadata:()=>p,toc:()=>l});var t=o(7462),a=(o(7294),o(3905));const n={title:"Body Parser",description:"See more about how to deal with content type parsing in serverless."},s=void 0,p={unversionedId:"main/frameworks/helpers/body-parser",id:"main/frameworks/helpers/body-parser",title:"Body Parser",description:"See more about how to deal with content type parsing in serverless.",source:"@site/docs/main/frameworks/helpers/body-parser.mdx",sourceDirName:"main/frameworks/helpers",slug:"/main/frameworks/helpers/body-parser",permalink:"/docs/main/frameworks/helpers/body-parser",draft:!1,editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/docs/main/frameworks/helpers/body-parser.mdx",tags:[],version:"current",frontMatter:{title:"Body Parser",description:"See more about how to deal with content type parsing in serverless."},sidebar:"main",previous:{title:"Helpers",permalink:"/docs/category/helpers"},next:{title:"CORS",permalink:"/docs/main/frameworks/helpers/cors"}},i={},l=[{value:"Why?",id:"why",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Usage",id:"usage",level:2},{value:"Customizing",id:"customizing",level:2}],m={toc:l},d="wrapper";function c(e){let{components:r,...o}=e;return(0,a.kt)(d,(0,t.Z)({},m,o,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This framework is a helper framework that wraps around another framework and gets some options to configure content parsing in your app using the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/expressjs/body-parser"},"body-parser")," library behind the scenes."),(0,a.kt)("h2",{id:"why"},"Why?"),(0,a.kt)("p",null,"Why should I use this framework instead of directly using my framework/application's ",(0,a.kt)("inlineCode",{parentName:"p"},"joe-doe-body-parser")," package?"),(0,a.kt)("p",null,"Frameworks like ",(0,a.kt)("inlineCode",{parentName:"p"},"trpc"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"deep\u1e31it")," and other frameworks don't have a good way of dealing with content parsing, so with ",(0,a.kt)("inlineCode",{parentName:"p"},"BodyParserFramework")," you can do the content parsing\nworks for these frameworks."),(0,a.kt)("h2",{id:"requirements"},"Requirements"),(0,a.kt)("p",null,"To be able to use, first you need to install some packages:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm i --save body-parser http-errors\n")),(0,a.kt)("p",null,"If you are using TypeScript:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm i --save-dev @types/body-parser\n")),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("p",null,"Like ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/expressjs/body-parser"},"body-parser"),", you have four types of content that we support:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"application/json")," using ",(0,a.kt)("a",{parentName:"li",href:"/docs/api/Frameworks/BodyParserFramework/JsonBodyParserFramework"},"JsonBodyParserFramework"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"text/plain")," using ",(0,a.kt)("a",{parentName:"li",href:"/docs/api/Frameworks/BodyParserFramework/TextBodyParserFramework"},"TextBodyParserFramework"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"application/octet-stream")," using ",(0,a.kt)("a",{parentName:"li",href:"/docs/api/Frameworks/BodyParserFramework/RawBodyParserFramework"},"RawBodyParserFramework"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"application/x-www-form-urlencoded")," using ",(0,a.kt)("a",{parentName:"li",href:"/docs/api/Frameworks/BodyParserFramework/UrlencodedBodyParserFramework"},"UrlencodedBodyParserFramework"),".")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"If you have sent any other type of content using these body parsers, the body parser will skip parsing your content.")),(0,a.kt)("p",null,"The first parameter is the instance of another framework, so if you want to use ",(0,a.kt)("a",{parentName:"p",href:"../express"},"Express")," for example and want to parse ",(0,a.kt)("inlineCode",{parentName:"p"},"application/json"),", you can use like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\nimport { JsonBodyParserFramework, JsonBodyParserFrameworkOptions } from '@h4ad/serverless-adapter/lib/frameworks/cors';\nimport { ExpressFramework } from '@h4ad/serverless-adapter/lib/frameworks/express';\n\nconst express = require('express');\n\nconst expressFramework = new ExpressFramework();\n// see docs about the options in the original package:\n// https://github.com/expressjs/body-parser#bodyparserjsonoptions\nconst options: JsonBodyParserFrameworkOptions = { limit: 1024 * 1024 }; // limit body to 1mb\nconst framework = new JsonBodyParserFramework(expressFramework, options);\n\nexport const handler = ServerlessAdapter.new(express)\n  .setFramework(framework)\n  // continue to set the other options here.\n  //.setHandler(new DefaultHandler())\n  //.setResolver(new PromiseResolver())\n  //.addAdapter(new AlbAdapter())\n  //.addAdapter(new SQSAdapter())\n  //.addAdapter(new SNSAdapter())\n  // after put all methods necessary, just call the build method.\n  .build();\n")),(0,a.kt)("p",null,"If you want to combine with more frameworks, just add others like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\nimport { JsonBodyParserFramework, UrlencodedBodyParserFramework, RawBodyParserFramework } from '@h4ad/serverless-adapter/lib/frameworks/body-parser';\nimport { CorsFramework } from '@h4ad/serverless-adapter/lib/frameworks/cors';\nimport { ExpressFramework } from '@h4ad/serverless-adapter/lib/frameworks/express'; import {  } from './cors.framework';\n\nconst expressFramework = new ExpressFramework();\n\n// combine as much as you want\nconst framework = new UrlencodedBodyParserFramework(\n  new RawBodyParserFramework(\n    new JsonBodyParserFramework(\n      expressFramework,\n      { limit: 1024 * 1024 }, // options\n    ),\n    { limit: 1024 * 1024 }, // options\n  ),\n  { limit: 1024 * 1024 }, // options\n);\n\n// you can also combine with cors\nconst finalFramework = new CorsFramework(framework);\n")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Is your application instance creation asynchronous? Look the ",(0,a.kt)("a",{parentName:"p",href:"./lazy"},"LazyFramework")," which helps you in asynchronous startup.")),(0,a.kt)("h2",{id:"customizing"},"Customizing"),(0,a.kt)("p",null,"If you want to customize the error messages, like when the size limit is exceeded, you can use ",(0,a.kt)("inlineCode",{parentName:"p"},"customErrorHandler"),", like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { IncomingMessage, ServerResponse } from 'http';\nimport type { HttpError } from 'http-errors';\nimport { JsonBodyParserFramework, JsonBodyParserFrameworkOptions } from '@h4ad/serverless-adapter/lib/frameworks/body-parser';\n\nconst options: JsonBodyParserFrameworkOptions = {\n  customErrorHandler: (req: IncomingMessage, response: ServerResponse, error: HttpError<any>) => {\n    response.setHeader('content-type', 'application/json');\n    response.statusCode = error.statusCode;\n    // always call end to return the error\n    response.end(JSON.stringify({\n      message: error.message,\n    }));\n  },\n};\nconst framework = new JsonBodyParserFramework(expressFramework, options);\n")))}c.isMDXComponent=!0}}]);