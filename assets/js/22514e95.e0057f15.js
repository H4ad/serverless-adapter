"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5614],{7628:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var r=n(4848),i=n(8453);const o={title:"Http Function",description:"See more about how to integrate with DigitalOcean Functions"},s=void 0,a={id:"main/adapters/digital-ocean/http-function",title:"Http Function",description:"See more about how to integrate with DigitalOcean Functions",source:"@site/docs/main/adapters/digital-ocean/http-function.mdx",sourceDirName:"main/adapters/digital-ocean",slug:"/main/adapters/digital-ocean/http-function",permalink:"/docs/main/adapters/digital-ocean/http-function",draft:!1,unlisted:!1,editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/docs/main/adapters/digital-ocean/http-function.mdx",tags:[],version:"current",frontMatter:{title:"Http Function",description:"See more about how to integrate with DigitalOcean Functions"},sidebar:"main",previous:{title:"Digital Ocean",permalink:"/docs/category/digital-ocean"},next:{title:"Firebase",permalink:"/docs/main/adapters/firebase"}},d={},c=[{value:"Requirements",id:"requirements",level:2},{value:"About the adapter",id:"about-the-adapter",level:2},{value:"Customizing",id:"customizing",level:2},{value:"Usage",id:"usage",level:2},{value:"Examples",id:"examples",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.admonition,{title:"Attention",type:"caution",children:(0,r.jsxs)(t.p,{children:["Check the ",(0,r.jsx)(t.a,{href:"../../handlers/digital-ocean",children:"DigitalOceanHandler"})," docs to make sure you have all the necessary settings to work with this adapter."]})}),"\n",(0,r.jsxs)(t.p,{children:["The adapter to handle requests from ",(0,r.jsx)(t.a,{href:"https://docs.digitalocean.com/products/functions/quickstart/sample-functions/",children:"DigitalOcean Functions"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsxs)(t.p,{children:["When an error is thrown during forwarding and the ",(0,r.jsx)(t.code,{children:"responseWithErrors"})," option is ",(0,r.jsx)(t.code,{children:"true"}),", we return a 500 status WITH error stack in the response."]})}),"\n",(0,r.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(t.p,{children:["When you work with DigitalOcean Functions, in the root of your repository you will have a file called ",(0,r.jsx)(t.code,{children:"project.yml"})," which is used\r\nto determine the structure of your functions and will be used to deploy your code to DigitalOcean."]}),"\n",(0,r.jsxs)(t.p,{children:["To this library understand the requests coming from DigitalOcean, you need to modify the default code of ",(0,r.jsx)(t.code,{children:"project.yml"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-diff",children:"packages:\r\n  - name: [name-of-your-api]\r\n    functions:\r\n      - name: 'prod'\r\n        main: ''\r\n        runtime: 'nodejs:18'\r\n-        web: true\r\n+        web: 'raw'\n"})}),"\n",(0,r.jsx)(t.h2,{id:"about-the-adapter",children:"About the adapter"}),"\n",(0,r.jsx)(t.p,{children:"This adapter transforms every request coming from DigitalOcean Functions into an HTTP request to your framework."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",metastring:'title="digital-ocean-http-function-event-example.json"',children:'{\r\n  "__ow_method": "post",\r\n  "__ow_query": "potato=true",\r\n  "__ow_body": "{\\"test\\":true}",\r\n  "__ow_headers": {\r\n    "accept": "*/*",\r\n    "accept-encoding": "gzip",\r\n    "cdn-loop": "cloudflare",\r\n    "cf-connecting-ip": "45.444.444.444",\r\n    "cf-ipcountry": "BR",\r\n    "cf-ray": "xxxxxxxxxxx-GRU",\r\n    "cf-visitor": "{\\"scheme\\":\\"https\\"}",\r\n    "host": "ccontroller",\r\n    "user-agent": "insomnia/2022.4.2",\r\n    "x-custom": "potato",\r\n    "x-forwarded-for": "45.444.444.444",\r\n    "x-forwarded-proto": "https",\r\n    "x-request-id": "xxxxxxxxxxxxxxxx"\r\n  },\r\n  "__ow_path": "/store"\r\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["So, to add support to the above request, we must have registered the ",(0,r.jsx)(t.code,{children:"/store"})," route as ",(0,r.jsx)(t.code,{children:"POST"})," and when DigitalOcean sends this event, you will get:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"body"}),": ",(0,r.jsx)(t.code,{children:'{"test":true}'})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"queryString"}),": ",(0,r.jsx)(t.code,{children:"potato=true"})]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"customizing",children:"Customizing"}),"\n",(0,r.jsxs)(t.p,{children:["You can strip base path with the option ",(0,r.jsx)(t.code,{children:"stripBasePath"})," inside ",(0,r.jsx)(t.a,{href:"/docs/api/Adapters/Digital%20Ocean/HttpFunctionAdapter/HttpFunctionAdapterOptions",children:"HttpFunctionAdapterOptions"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsxs)(t.p,{children:["You can configure this option based on your api base url like: ",(0,r.jsx)(t.code,{children:"/api/test-serverless-adapter"}),", then the request coming from ",(0,r.jsx)(t.code,{children:"/api/test-serverless-adapter/events"}),"\r\nwill be transformed into ",(0,r.jsx)(t.code,{children:"/events"}),"."]})}),"\n",(0,r.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(t.p,{children:"To add support to DigitalOcean Functions you do the following:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="index.ts"',children:"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\r\nimport { DigitalOceanHandler } from '@h4ad/serverless-adapter/handlers/digital-ocean';\r\nimport { PromiseResolver } from '@h4ad/serverless-adapter/resolvers/promise';\r\nimport { HttpFunctionAdapter } from '@h4ad/serverless-adapter/adapters/digital-ocean';\r\nimport app from './app';\r\n\r\nexport const main = ServerlessAdapter.new(app)\r\n  .setHandler(new DigitalOceanHandler())\r\n  .setResolver(new PromiseResolver())\r\n  // continue to set the other options here.\r\n  // .setFramework(new ExpressFramework())\r\n  .addAdapter(new HttpFunctionAdapter())\r\n  .build();\n"})}),"\n",(0,r.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsxs)(t.p,{children:["You can see examples of how to use ",(0,r.jsx)(t.a,{href:"https://github.com/H4ad/serverless-adapter-examples",children:"here"}),"."]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var r=n(6540);const i={},o=r.createContext(i);function s(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);