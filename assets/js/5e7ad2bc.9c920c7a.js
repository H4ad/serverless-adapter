"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1470],{3029:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>c,frontMatter:()=>a,metadata:()=>o,toc:()=>i});var n=s(4848),t=s(8453);const a={title:"AWS",description:"See more about how to integrate with AWS Lambda."},d=void 0,o={id:"main/handlers/aws",title:"AWS",description:"See more about how to integrate with AWS Lambda.",source:"@site/docs/main/handlers/aws.mdx",sourceDirName:"main/handlers",slug:"/main/handlers/aws",permalink:"/docs/main/handlers/aws",draft:!1,unlisted:!1,editUrl:"https://github.com/H4ad/serverless-adapter/tree/main/www/docs/main/handlers/aws.mdx",tags:[],version:"current",frontMatter:{title:"AWS",description:"See more about how to integrate with AWS Lambda."},sidebar:"main",previous:{title:"Handlers",permalink:"/docs/category/handlers"},next:{title:"Azure",permalink:"/docs/main/handlers/azure"}},l={},i=[{value:"Usage",id:"usage",level:2},{value:"AWS Lambda Response Streaming",id:"aws-lambda-response-streaming",level:2},{value:"My execution is taking too long",id:"my-execution-is-taking-too-long",level:3},{value:"Can I use SQS and other services?",id:"can-i-use-sqs-and-other-services",level:3},{value:"Examples",id:"examples",level:2}];function h(e){const r={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.admonition,{type:"tip",children:(0,n.jsxs)(r.p,{children:["Don't know what a handler is? See the ",(0,n.jsx)(r.a,{href:"../architecture#handler",children:"Architecture"})," section."]})}),"\n",(0,n.jsx)(r.p,{children:"This is a serverless handler implementation that will return a function that expect to receive the following arguments: event, context and callback, respectively."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",children:"function(event, context, callback) {...}\n"})}),"\n",(0,n.jsx)(r.p,{children:"If your cloud's serverless handler signature is the same, you can use this handler."}),"\n",(0,n.jsx)(r.p,{children:"This is usually enough to add support for clouds like: AWS, Huawei and others."}),"\n",(0,n.jsx)(r.h2,{id:"usage",children:"Usage"}),"\n",(0,n.jsxs)(r.p,{children:["To use, you can import and call the method ",(0,n.jsx)(r.a,{href:"../../api/ServerlessAdapter#method-sethandler",children:"setHandler"}),", as per the code below:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'title="index.ts"',children:"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\r\nimport { DefaultHandler } from '@h4ad/serverless-adapter/handlers/default';\r\nimport app from './app';\r\n\r\nexport const handler = ServerlessAdapter.new(app)\r\n  .setHandler(new DefaultHandler())\r\n  // continue to set the other options here.\r\n  //.setResolver(new PromiseResolver())\r\n  //.setFramework(new ExpressFramework())\r\n  //.addAdapter(new AlbAdapter())\r\n  //.addAdapter(new SQSAdapter())\r\n  //.addAdapter(new SNSAdapter())\r\n  // after put all methods necessary, just call the build method.\r\n  .build();\n"})}),"\n",(0,n.jsx)(r.h2,{id:"aws-lambda-response-streaming",children:"AWS Lambda Response Streaming"}),"\n",(0,n.jsx)(r.admonition,{type:"info",children:(0,n.jsxs)(r.p,{children:["This handler is intended to be used when you integrate with ",(0,n.jsx)(r.code,{children:"FunctionURLs"}),", which is the only service that supports streaming on AWS currently,\r\n",(0,n.jsx)(r.a,{href:"https://aws.amazon.com/blogs/compute/introducing-aws-lambda-response-streaming/",children:"read more"}),"."]})}),"\n",(0,n.jsxs)(r.p,{children:["By default, every Lambda will be ",(0,n.jsx)(r.code,{children:"BUFFERED"}),", which means we need to wait for the framework to write all the content of the response until we send it to the user."]}),"\n",(0,n.jsxs)(r.p,{children:["But when you enable the ",(0,n.jsx)(r.code,{children:"RESPONSE_STREAM"})," mode within your Lambda settings, the framework will send the response to the user as fast as possible, without waiting for the framework to write all the content."]}),"\n",(0,n.jsx)(r.p,{children:"To support this behavior, we need to change three things:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Instead of ",(0,n.jsx)(r.code,{children:"DefaultHandler"}),", you should use ",(0,n.jsx)(r.a,{href:"../../api/handlers/AwsStreamHandler",children:"AwsStreamHandler"}),"."]}),"\n",(0,n.jsxs)(r.li,{children:["Instead of ",(0,n.jsx)(r.code,{children:"PromiseResolver"})," or whatever, you should use ",(0,n.jsx)(r.a,{href:"../../api/resolvers/DummyResolver",children:"DummyResolver"}),".","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Resolvers are not used in this mode, so you can just use this dummy version."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["Add the adapter ",(0,n.jsx)(r.a,{href:"../../api/adapters/aws/ApiGatewayV2Adapter",children:"ApiGatewayV2Adapter"}),".","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"It is required to handle function URLs, but you can add more if you wish."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'title="index.ts"',children:"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\r\nimport { AwsStreamHandler } from '@h4ad/serverless-adapter/handlers/aws';\r\nimport { DummyResolver } from '@h4ad/serverless-adapter/resolvers/dummy';\r\nimport { ApiGatewayV2Adapter } from '@h4ad/serverless-adapter/adapters/aws';\r\nimport app from './app';\r\n\r\nexport const handler = ServerlessAdapter.new(app)\r\n  .setHandler(new AwsStreamHandler())\r\n  .setResolver(new DummyResolver())\r\n  .setAdapter(new ApiGatewayV2Adapter())\r\n  // continue to set the other options here.\r\n  //.addAdapter(new AlbAdapter())\r\n  //.addAdapter(new SQSAdapter())\r\n  //.addAdapter(new SNSAdapter())\r\n  //.setFramework(new ExpressFramework())\r\n  // after put all methods necessary, just call the build method.\r\n  .build();\n"})}),"\n",(0,n.jsxs)(r.p,{children:["As you see, we only have to change the ",(0,n.jsx)(r.code,{children:"setHandler"}),", ",(0,n.jsx)(r.code,{children:"setResolver"})," and ",(0,n.jsx)(r.code,{children:"setAdapter"})," methods, that's all!"]}),"\n",(0,n.jsx)(r.h3,{id:"my-execution-is-taking-too-long",children:"My execution is taking too long"}),"\n",(0,n.jsxs)(r.p,{children:["Well, maybe is caused because your event loop is not empty when the request finishes, in this case, you can set ",(0,n.jsx)(r.code,{children:"callbackWaitsForEmptyEventLoop=false"})," on ",(0,n.jsx)(r.a,{href:"../../api/handlers/AwsStreamHandler",children:"AwsStreamHandler"}),"."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'title="index.ts"',children:"import { ServerlessAdapter } from '@h4ad/serverless-adapter';\r\nimport { AwsStreamHandler } from '@h4ad/serverless-adapter/handlers/aws';\r\nimport { DummyResolver } from '@h4ad/serverless-adapter/resolvers/dummy';\r\nimport { ApiGatewayV2Adapter } from '@h4ad/serverless-adapter/adapters/aws';\r\nimport app from './app';\r\n\r\nexport const handler = ServerlessAdapter.new(app)\r\n  .setHandler(new AwsStreamHandler({ callbackWaitsForEmptyEventLoop: false }))\r\n  .setResolver(new DummyResolver())\r\n  .setAdapter(new ApiGatewayV2Adapter())\r\n  // continue to set the other options here.\r\n  //.addAdapter(new AlbAdapter())\r\n  //.addAdapter(new SQSAdapter())\r\n  //.addAdapter(new SNSAdapter())\r\n  //.setFramework(new ExpressFramework())\r\n  // after put all methods necessary, just call the build method.\r\n  .build();\n"})}),"\n",(0,n.jsx)(r.h3,{id:"can-i-use-sqs-and-other-services",children:"Can I use SQS and other services?"}),"\n",(0,n.jsxs)(r.p,{children:["Well, I don't know, but you can try. At least with ",(0,n.jsx)(r.code,{children:"SQS"})," I was able to get the messages, but I couldn't use the ",(0,n.jsx)(r.code,{children:"partial batch response"})," feature."]}),"\n",(0,n.jsx)(r.p,{children:"Other services may or may not work, at least if it's a service that doesn't need a response, maybe it works now."}),"\n",(0,n.jsx)(r.h2,{id:"examples",children:"Examples"}),"\n",(0,n.jsxs)(r.p,{children:["You can see examples of how to use ",(0,n.jsx)(r.a,{href:"https://github.com/H4ad/serverless-adapter-examples",children:"here"}),"."]})]})}function c(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>d,x:()=>o});var n=s(6540);const t={},a=n.createContext(t);function d(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);