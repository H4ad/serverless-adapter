<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">4 posts tagged with &quot;serverless-adapter&quot; | Serverless Adapter</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://serverless-adapter.viniciusl.com.br/blog/tags/serverless-adapter"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="4 posts tagged with &quot;serverless-adapter&quot; | Serverless Adapter"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://serverless-adapter.viniciusl.com.br/blog/tags/serverless-adapter"><link data-rh="true" rel="alternate" href="https://serverless-adapter.viniciusl.com.br/blog/tags/serverless-adapter" hreflang="en"><link data-rh="true" rel="alternate" href="https://serverless-adapter.viniciusl.com.br/blog/tags/serverless-adapter" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://G7D9713FAL-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Serverless Adapter RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Serverless Adapter Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Serverless Adapter" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.13c22530.css">
<script src="/assets/js/runtime~main.b733e864.js" defer="defer"></script>
<script src="/assets/js/main.2a2db697.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Serverless Adapter" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Serverless Adapter" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Serverless Adapter</b></a><a class="navbar__item navbar__link" sidebarid="main" href="/docs/main/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/api/Introduction">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/h4ad/serverless-adapter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/dual-package-publish">Support for Dual Package Publish</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/aws-lambda-response-streaming">AWS Lambda Response Streaming</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/updates-and-releases">Updates and Releases</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/the-beginning">The Beginning</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><header class="margin-bottom--xl"><h1>4 posts tagged with &quot;serverless-adapter&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Two paths inside a forest!"><link itemprop="image" href="https://images.unsplash.com/photo-1429743305873-d4065c15f93e"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/dual-package-publish">Support for Dual Package Publish</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-25T00:00:00.000Z" itemprop="datePublished">December 25, 2023</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/h4ad" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/h4ad.png" alt="Vinícius Lourenço" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/h4ad" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Vinícius Lourenço</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Serverless Adapter</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://images.unsplash.com/photo-1429743305873-d4065c15f93e" alt="Two paths inside a forest!" class="img_ev3q"></p>
<blockquote>
<p>Image by <a href="https://unsplash.com/@madebyjens" target="_blank" rel="noopener noreferrer">Jens Lelie</a> on <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a></p>
</blockquote>
<p>This feature was initially asked by <a href="https://github.com/ClementCornut" target="_blank" rel="noopener noreferrer">ClementCornut</a> on issue <a href="https://github.com/H4ad/serverless-adapter/issues/127" target="_blank" rel="noopener noreferrer">#127</a>.</p>
<p>Initially I was a little unsure whether to publish <code>esm</code> and <code>cjs</code>, but then I started to like the idea of exporting
my packages as <code>@h4ad/serverless-adapter/adapters/aws</code>.</p>
<p>You can use it by installing the new version:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm i @h4ad/serverless-adapter@4.0.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>The version 4.0.0 was released with a bug that didn&#x27;t include the package files, so I released the version 4.0.1 to fix this issue.</p>
</blockquote>
<p>In the previous version, since I only export to <code>commonjs</code>, you need to import the files as <code>/lib/adapters/aws</code>, which is not bad, but not exactly good.
This was necessary because I can&#x27;t export all files in the default <code>export</code> as this will lead you to install all frameworks supported by this library.</p>
<p>But ok, I had some problems while adding support for dual-package publishing which I want to share with you only,
and especially for my future version if you want to add support for dual-package publishing in your modules.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vite">Vite<a href="#vite" class="hash-link" aria-label="Direct link to Vite" title="Direct link to Vite">​</a></h2>
<p>I already use <code>vitest</code> test my package and to build the previous versions,
it works great and is specially fast to run the tests (5.82s to run 456 tests across 52 files).</p>
<p>But the configuration to build was a little bit nightmare:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">vite.config.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// some initial configuration lines...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">isTest </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    esbuild</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      format</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;cjs&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      platform</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;node&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;node18&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sourcemap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;external&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      minifyIdentifiers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      outDir</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;lib&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      emptyOutDir</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sourcemap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      lib</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        entry</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;src/index.ts&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        formats</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;cjs&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rollupOptions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        external</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;yeoman-generator&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> glob</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;src/**/*.ts&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preserveModules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function-variable function" style="color:#d73a49">entryFileNames</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> entry </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> entry</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fileName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.js</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> fileName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>All of this configuration was necessary as I need to build my package to match exactly the same structure as <code>src</code>,
which was needed for users to import as <code>/lib/adapters/aws</code>.</p>
<p>On the first attempt, I just tried to extend this configuration, but I spent a few hours and managed to generate
a good package output, but it was missing some details that were very painful to bear, such as correctly emitting <code>d.cts</code>.</p>
<p>If you want to see how it turned out, if you want to try doing this using <code>vite</code> directly,
<a href="https://github.com/H4ad/serverless-adapter/blob/f642739334687b0a22312074a6e225e9f8ac8124/vite.config.ts" target="_blank" rel="noopener noreferrer">here is vite.config.ts</a>.</p>
<p>But then I started to give up and <a href="https://twitter.com/vinii_joga10/status/1738954683853451760" target="_blank" rel="noopener noreferrer">tweeted about it</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="suggestions-from-twitter">Suggestions from Twitter<a href="#suggestions-from-twitter" class="hash-link" aria-label="Direct link to Suggestions from Twitter" title="Direct link to Suggestions from Twitter">​</a></h2>
<p>I got some incredible helpful messages on twitter and I will cover those suggestions that I applied to be able to finally support dual package publish.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="re-exporting-on-mjs">Re-exporting on mjs<a href="#re-exporting-on-mjs" class="hash-link" aria-label="Direct link to Re-exporting on mjs" title="Direct link to Re-exporting on mjs">​</a></h3>
<p>This was a suggestion from <a href="https://twitter.com/matteocollina" target="_blank" rel="noopener noreferrer">Matteo Collina</a>, he also sent me the package <a href="https://github.com/mcollina/snap" target="_blank" rel="noopener noreferrer">snap</a> which does this re-export,
which I also saw being used in <a href="https://github.com/oramasearch/orama/blob/main/packages/orama/src/cjs/index.cts" target="_blank" rel="noopener noreferrer">Orama</a>, is basically doing this:</p>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate"><a href="https://nodejs.org/api/packages.html#approach-2-isolate-state" target="_blank" rel="noopener">https://nodejs.org/api/packages.html#approach-2-isolate-state</a></div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><p>Your state:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">./node_modules/pkg/state.cjs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;date&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> someDate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Define/export on <code>cjs</code>.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">./node_modules/pkg/index.cjs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;./state.cjs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Re-export on <code>mjs</code>.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">./node_modules/pkg/index.mjs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">state</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./state.cjs&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token exports punctuation" style="color:#393A34">{</span><span class="token exports"></span><br></span><span class="token-line" style="color:#393A34"><span class="token exports">state</span><span class="token exports punctuation" style="color:#393A34">,</span><span class="token exports"></span><br></span><span class="token-line" style="color:#393A34"><span class="token exports"></span><span class="token exports punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<p>This way, I solve the problem of state isolation, but I will need:</p>
<ul>
<li>or manually export all these files</li>
<li>or use a tool to automate this process</li>
</ul>
<p>Both ways will be a bit painful to maintain, so I didn&#x27;t go that route.</p>
<p>This approach can be fine if your library maintains state and the codebase is pure javascript.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tsup">tsup<a href="#tsup" class="hash-link" aria-label="Direct link to tsup" title="Direct link to tsup">​</a></h3>
<p>Instead of trying to go through this configuration hell in <code>vite</code>, <a href="https://twitter.com/MicheleRivaCode" target="_blank" rel="noopener noreferrer">Michele Riva</a>
suggested <a href="https://tsup.egoist.dev/" target="_blank" rel="noopener noreferrer">tsup</a> which is incredibly easy to use.</p>
<p>I spent less than 10 minutes to generate almost the same output as the previous configuration with <code>vite</code>,
but this time the output was correct, with <code>d.cts</code> files being generated.</p>
<p>My configuration file now looks like this:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">tsup.config.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defineConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outDir</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./lib&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clean</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dts</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  format</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;esm&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;cjs&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">outExtension</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> format </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    js</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> format </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;cjs&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.cjs&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.mjs&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cjsInterop</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// the libEntries is basically all the entries I need to export,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// like: adapters/aws, frameworks/fastify, etc...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  entry</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;src/index.ts&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">libEntries</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sourcemap</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  skipNodeModulesBundle</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  minify</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;es2022&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tsconfig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./tsconfig.build.json&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  keepNames</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bundle</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="packagejson-exports">package.json exports<a href="#packagejson-exports" class="hash-link" aria-label="Direct link to package.json exports" title="Direct link to package.json exports">​</a></h3>
<p>Since I have a lot of things to export, I also automate the configuration of <code>exports</code> in <code>package.json</code> with:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">tsup.config.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// I do the same for adapters, frameworks and handlers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> resolvers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;aws-context&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;callback&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dummy&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;promise&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> libEntries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">resolvers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolver </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">src/resolvers/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">resolver</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/index.ts</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createExport</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">import</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">./lib/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">filePath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.d.ts</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">./lib/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">filePath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.mjs</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">require</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">./lib/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">filePath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.d.cts</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">./lib/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">filePath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.cjs</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createExportReducer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initialPath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">acc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> object</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    acc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">./</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">initialPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createExport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">initialPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/index</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    acc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">./lib/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">initialPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createExport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">initialPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/index</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> acc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> packageExports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&#x27;.&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createExport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;index&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">resolvers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">createExportReducer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;resolvers&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// and I also do the same for adapters, frameworks and handlers.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// this command does the magic to update my package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">execSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">npm pkg set exports=&#x27;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">JSON</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">stringify</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">packageExports</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">&#x27; --json</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This works incredible and also keep my <code>package.json</code> updated.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="module-not-found-on-moduleresolution-node">Module not found on moduleResolution <code>node</code><a href="#module-not-found-on-moduleresolution-node" class="hash-link" aria-label="Direct link to module-not-found-on-moduleresolution-node" title="Direct link to module-not-found-on-moduleresolution-node">​</a></h3>
<p>But there is one thing you should pay attention to, did you see that I export files with the prefix <code>./lib</code>?</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">package.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;exports&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;./adapters/apollo-server&quot;: {...},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;./lib/adapters/apollo-server&quot;: {...},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The content of both is the same, but I do this to be compatible with the resolution of <code>node</code>.
Without this configuration, the <code>IDE</code> will show the import to <code>@h4ad/serverless-adapter/adapters/apollo-server</code> as resolved, but
<code>node</code> will not be able to find the file during the runtime.</p>
<p>And the interesting part of doing this is that people who import this package with <code>/lib</code> will still be able to import the code,
and they won&#x27;t need any code modifications.</p>
<p>Maybe I could release this feature without it being a breaking change with this change, but to be on the safe side,
I released it as a breaking change anyway.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="publint">publint<a href="#publint" class="hash-link" aria-label="Direct link to publint" title="Direct link to publint">​</a></h3>
<p>The <a href="https://publint.dev/" target="_blank" rel="noopener noreferrer">publint</a> is a tool that I learned on <a href="https://blog.isquaredsoftware.com/2023/08/esm-modernization-lessons/#early-attempts" target="_blank" rel="noopener noreferrer">ESM Modernization Lessons</a> inside <code>Early Attempts</code>,
this article was a suggestion by <a href="https://twitter.com/LucaRams23" target="_blank" rel="noopener noreferrer">Luca Micieli</a>.</p>
<p>With this tool, I detect several problems with the <code>exports</code> configuration and this will make your life a lot easier.</p>
<p>But this tool has a problem that they didn&#x27;t catch, and this problem was pointed out by <a href="https://twitter.com/MicheleRivaCode" target="_blank" rel="noopener noreferrer">Michele Riva</a>, instead:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">package.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;exports&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;resolvers/promise&quot;: {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I should export it with the prefix <code>./</code>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">package.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;exports&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;./resolvers/promise&quot;: {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This small detail can make your configuration fail.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verdaccio">verdaccio<a href="#verdaccio" class="hash-link" aria-label="Direct link to verdaccio" title="Direct link to verdaccio">​</a></h3>
<p>The <a href="https://verdaccio.org/" target="_blank" rel="noopener noreferrer">verdaccio</a> was suggested by <a href="https://twitter.com/imabhiprasad" target="_blank" rel="noopener noreferrer">Abhijeet Prasad</a>, with this tool you can have your private registry that you can use to test,
Abhijeet use this tool on <a href="https://sentry.io/" target="_blank" rel="noopener noreferrer">Sentry</a> SDKs to do e2e tests.</p>
<p>With this tool, I was able to make sure the package was working correctly with the new dual package publish.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="wrong-moduleresolution">Wrong <code>moduleResolution</code><a href="#wrong-moduleresolution" class="hash-link" aria-label="Direct link to wrong-moduleresolution" title="Direct link to wrong-moduleresolution">​</a></h3>
<p>It took me a while to realize, but while testing the changes in a sample project, the imports still failed because TypeScript couldn&#x27;t find the files.</p>
<p>So I remember the suggestion from <a href="https://twitter.com/samijaber_" target="_blank" rel="noopener noreferrer">sami</a> who gave me some examples of projects he uses
in <a href="https://github.com/BuilderIO/hydration-overlay/tree/main/tests" target="_blank" rel="noopener noreferrer">BuilderIO/hidration-overlay</a>,
and I understand the difference between <code>moduleResolution</code>, in my project it was configured for <code>node</code>,
in his project it was configured for <code>bundler</code>.</p>
<p>When I changed this setting, all imports started working and imports using <code>/lib/adapters/aws</code> started failing.</p>
<p>If you&#x27;re like me and have no idea what this setting is about, the documentation says:</p>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate"><a href="https://www.typescriptlang.org/tsconfig#moduleResolution" target="_blank" rel="noopener">https://www.typescriptlang.org/tsconfig#moduleResolution</a></div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><p>Specify the module resolution strategy:</p><p>&#x27;node16&#x27; or &#x27;nodenext&#x27; for modern versions of Node.js. Node.js v12 and later supports both ECMAScript imports and
CommonJS require, which resolve using different algorithms. These moduleResolution values, when combined with the
corresponding module values, picks the right algorithm for each resolution based on whether Node.js will see an import
or require in the output JavaScript code.</p><p>&#x27;node10&#x27; (previously called &#x27;node&#x27;) for Node.js versions older than v10, which only support CommonJS require. You
probably won’t need to use node10 in modern code.</p><p>&#x27;bundler&#x27; for use with bundlers. Like node16 and nodenext, this mode supports package.json &quot;imports&quot; and &quot;exports&quot;,
but unlike the Node.js resolution modes, bundler never requires file extensions on relative paths in imports.</p></div></div>
<p>Make sense why it was not working at all, <code>node</code> was not built to support <code>exports</code>, and only <code>nodenext</code> and <code>bundler</code> should work correctly.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="doubling-the-package-size">Doubling the package size<a href="#doubling-the-package-size" class="hash-link" aria-label="Direct link to Doubling the package size" title="Direct link to Doubling the package size">​</a></h2>
<p>Something I saw that made me a little worried was the size of this package, since I need to export the code, types and source maps twice, the package
went from <code>~600Kb</code> to <code>~1.5Mb</code>.</p>
<p>I enabled minification to try to reduce the amount of code shipped, but if you use this library and don&#x27;t have any kind of minification/bundling
during your build, I highly recommend you look into these libraries to help you with the size of your zip file being uploaded:</p>
<ul>
<li><a href="https://github.com/H4ad/node-modules-packer" target="_blank" rel="noopener noreferrer">@h4ad/node-modules-packer</a></li>
<li><a href="https://github.com/vercel/ncc" target="_blank" rel="noopener noreferrer">ncc</a></li>
<li><a href="https://github.com/netlify/zip-it-and-ship-it" target="_blank" rel="noopener noreferrer">zip-it-and-ship-it</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusions">Conclusions<a href="#conclusions" class="hash-link" aria-label="Direct link to Conclusions" title="Direct link to Conclusions">​</a></h2>
<p>The <code>esm</code> packages was a nightmare to support some time ago but the ecosystem is starting solving problems with new tools to bundle your project
instead of having to fight with your own configuration files.</p>
<p>The <code>cjs</code> is a no-brain solution, almost no configuration and it works great but maybe is not ideal for your consumers/clients, some of them can have issues
like <a href="https://github.com/ClementCornut" target="_blank" rel="noopener noreferrer">ClementCornut</a> that needed to import the files with the full path <code>import awsPkg from &quot;@h4ad/serverless-adapter/lib/adapters/aws/index.js&quot;;</code>.</p>
<p>When I started adding this feature, I had no knowledge of how to publish double packages, I basically go-horse in the early hours
of my implementation and then I started learning more about how it works and how to properly configure the package.</p>
<p>This makes me realize that dual-package publishing isn&#x27;t the nightmare I initially thought, I just didn&#x27;t learn from the
previous mistakes other people made and I should have read more articles about it before I started implementing it.</p>
<p>My sincere thanks to:</p>
<ul>
<li><a href="https://twitter.com/imabhiprasad" target="_blank" rel="noopener noreferrer">Abhijeet Prasad</a></li>
<li><a href="https://twitter.com/LucaRams23" target="_blank" rel="noopener noreferrer">Luca Micieli</a></li>
<li><a href="https://twitter.com/matteocollina" target="_blank" rel="noopener noreferrer">Matteo Collina</a></li>
<li><a href="https://twitter.com/MicheleRivaCode" target="_blank" rel="noopener noreferrer">Michele Riva</a></li>
<li><a href="https://twitter.com/samijaber_" target="_blank" rel="noopener noreferrer">sami</a></li>
</ul>
<p>Without you, it will probably take me a lot longer to be able to convince myself to go ahead and try again to add support
for dual-package publish after the first failures.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/serverless-adapter">serverless-adapter</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cjs">cjs</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/esm">esm</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/npm">npm</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/package">package</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/publish">publish</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="A beautiful stream!"><link itemprop="image" href="https://images.unsplash.com/photo-1527489377706-5bf97e608852"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aws-lambda-response-streaming">AWS Lambda Response Streaming</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-04-28T00:00:00.000Z" itemprop="datePublished">April 28, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/h4ad" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/h4ad.png" alt="Vinícius Lourenço" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/h4ad" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Vinícius Lourenço</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Serverless Adapter</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://images.unsplash.com/photo-1527489377706-5bf97e608852" alt="A beautiful stream!" class="img_ev3q"></p>
<blockquote>
<p>Image by <a href="https://unsplash.com/@the_bracketeer" target="_blank" rel="noopener noreferrer">Hendrik Cornelissen</a> on <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a></p>
</blockquote>
<p>It&#x27;s been a long time since I wrote a post here, but I&#x27;m happy to share this new announcement.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="first-are-you-new-to-this-library">First, are you new to this library?<a href="#first-are-you-new-to-this-library" class="hash-link" aria-label="Direct link to First, are you new to this library?" title="Direct link to First, are you new to this library?">​</a></h2>
<p><img loading="lazy" alt="First time?" src="/assets/images/first-time-meme-first-time-3b9ed63592d7e85d38fb81a1dae3b345.gif" width="498" height="280" class="img_ev3q"></p>
<p>Let me introduce the library first, I named <a href="/docs/main/intro">Serverless Adapter</a> because my goal is connect any serverless environment to any NodeJS framework.</p>
<p>So you could just plug your <a href="/docs/main/architecture#framework">framework</a>, use the correct <a href="/docs/main/architecture#handler">handler</a> for your serverless environment,
choose the <a href="/docs/main/architecture#adapter">adapters</a> and then you can deploy your application!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-does-this-library-support">What does this library support?<a href="#what-does-this-library-support" class="hash-link" aria-label="Direct link to What does this library support?" title="Direct link to What does this library support?">​</a></h3>
<p>Currently, we support <a href="/docs/category/frameworks">8 NodeJS frameworks</a>: <a href="/docs/main/frameworks/express">Express</a>, <a href="/docs/main/frameworks/fastify">Fastify</a>, <a href="/docs/main/frameworks/trpc">tRPC</a>, <a href="/docs/main/frameworks/apollo-server">Apollo Server</a>, <a href="/docs/main/frameworks/nestjs">NestJS</a>, <a href="/docs/main/frameworks/deepkit">Deepkit</a>, <a href="/docs/main/frameworks/koa">Koa</a> and <a href="/docs/main/frameworks/Hapi">Hapi</a>.</p>
<p>We also support <a href="/docs/category/handlers">6 serverless environments</a>: <a href="/docs/main/handlers/aws">AWS</a>, <a href="/docs/main/handlers/azure">Azure</a>, <a href="/docs/main/handlers/gcp">Google Cloud</a>, <a href="/docs/main/handlers/digital-ocean">Digital Ocean</a>, <a href="/docs/main/handlers/firebase">Firebase</a> and <a href="/docs/main/handlers/huawei">Huawei</a>.</p>
<p>Talking about AWS, we support <a href="/docs/category/aws">10 different services</a> like API Gateway <a href="/docs/main/adapters/aws/api-gateway-v1">V1</a> and <a href="/docs/main/adapters/aws/api-gateway-v2">V2</a>, <a href="/docs/main/adapters/aws/sqs">SQS</a>, <a href="/docs/main/adapters/aws/sns">SNS</a>, etc... and you can combine them to use the same codebase and lambda to handle them all.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>To learn understand the power of this composability, check this article I wrote about how I went <a href="https://viniciusl.com.br/posts/2022/12/08-from-million-invocations-to-thousand-with-correct-caching/" target="_blank" rel="noopener noreferrer">From a million invocations to a thousand with correct caching</a>.</p></div></div>
<p>But okay, enough self-marketing, let&#x27;s get to the main point of this article.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-lambda-response-streaming">AWS Lambda Response Streaming<a href="#aws-lambda-response-streaming" class="hash-link" aria-label="Direct link to AWS Lambda Response Streaming" title="Direct link to AWS Lambda Response Streaming">​</a></h2>
<p>Today I&#x27;m rolling out support for <a href="https://aws.amazon.com/blogs/compute/introducing-aws-lambda-response-streaming/" target="_blank" rel="noopener noreferrer">AWS Lambda Streaming Response</a> using <a href="/docs/main/handlers/aws#aws-lambda-response-streaming">AwsStreamHandler</a>.</p>
<p>If you already use this library, just change <a href="/docs/main/handlers/aws#usage">DefaultHandler</a> to <a href="/docs/main/handlers/aws#aws-lambda-response-streaming">AwsStreamHandler</a>, and make sure you&#x27;re using <a href="/docs/api/Resolvers/DummyResolver">DummyResolver</a> and <a href="/docs/main/adapters/aws/api-gateway-v2">ApiGatewayV2Adapter</a>:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">index.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ServerlessAdapter </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@h4ad/serverless-adapter&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> AwsStreamHandler </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@h4ad/serverless-adapter/handlers/aws&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> DummyResolver </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@h4ad/serverless-adapter/resolvers/dummy&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ApiGatewayV2Adapter </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@h4ad/serverless-adapter/adapters/aws&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> app </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./app&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ServerlessAdapter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// .setHandler(new DefaultHandler())</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AwsStreamHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setResolver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DummyResolver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setAdapter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ApiGatewayV2Adapter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// more options...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//.setFramework(new ExpressFramework())</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>Despite its name, <code>ApiGatewayV2Adapter</code> can be used to support API Gateway V2 and function URLs.</p>
</blockquote>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Response streaming currently is only available for Function URLs.</p></div></div>
<p>That&#x27;s it :) Now you can use Function URLs and stream your content to the world!</p>
<div><p>Don&#x27;t forget to enable the feature in your AWS Lambda function by changing <code>BUFFERED</code> TO <code>RESPONSE_STREAM.</code></p></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="i-need-code">I NEED CODE!!!<a href="#i-need-code" class="hash-link" aria-label="Direct link to I NEED CODE!!!" title="Direct link to I NEED CODE!!!">​</a></h3>
<p>Well, if you&#x27;re the type of person who, like me, needs to see the code working, here&#x27;s a repository with several example projects using this library:
<a href="https://github.com/H4ad/serverless-adapter-examples" target="_blank" rel="noopener noreferrer">serverless-adapter-examples</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="beyond-http-requests">Beyond HTTP Requests<a href="#beyond-http-requests" class="hash-link" aria-label="Direct link to Beyond HTTP Requests" title="Direct link to Beyond HTTP Requests">​</a></h2>
<p>Furthermore, not only can you receive HTTP requests using <code>Function URLs</code>, but you can combine your <code>SQS</code> queue and use the same codebase to process everything.</p>
<p>I haven&#x27;t spent a lot of time testing it, but so far, any AWS service that supports this library can be hooked up to your Lambda function with <code>RESPONSE_STREAM</code> enabled.</p>
<p>The only thing you need to know is: the answer didn&#x27;t work as expected, I couldn&#x27;t get the <a href="/docs/main/adapters/aws/sqs#batch-item-failures">SQS Partial Response</a> to work for example .</p>
<p>But you can give it a try anyway, share your results with me on <a href="https://twitter.com/vinii_joga10" target="_blank" rel="noopener noreferrer">twitter</a> and I&#x27;ll be happy to help if I can.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Well, I don&#x27;t have much to say, but I hope you enjoy this new feature and use it to build amazing things.</p>
<p>I&#x27;ve spent the last 3 weeks trying to figure out how to make this work and I&#x27;m happy with the result.</p>
<p>If you&#x27;re curious enough to learn more about how I implement it, you can see <a href="https://github.com/H4ad/serverless-adapter/pull/90" target="_blank" rel="noopener noreferrer">this PR</a> with all my struggles and thoughts over the weeks.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/serverless-adapter">serverless-adapter</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/aws">aws</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/aws-lambda">aws-lambda</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/function-url">function-url</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="To the moon!"><link itemprop="image" href="https://images.unsplash.com/photo-1636819488524-1f019c4e1c44"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/updates-and-releases">Updates and Releases</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-17T00:00:00.000Z" itemprop="datePublished">July 17, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/h4ad" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/h4ad.png" alt="Vinícius Lourenço" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/h4ad" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Vinícius Lourenço</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Serverless Adapter</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://images.unsplash.com/photo-1636819488524-1f019c4e1c44" alt="To the moon!" class="img_ev3q"></p>
<p>Now we have more Handlers, Frameworks and Adapters, let&#x27;s see what&#x27;s new.</p>
<blockquote>
<p>From <a href="https://github.com/H4ad/serverless-adapter/tree/v2.3.2" target="_blank" rel="noopener noreferrer">v2.3.2</a> to <a href="https://github.com/H4ad/serverless-adapter/tree/v2.6.0" target="_blank" rel="noopener noreferrer">v2.6.0</a>,
compare the changes <a href="https://github.com/H4ad/serverless-adapter/compare/v2.3.2...v2.6.0" target="_blank" rel="noopener noreferrer">here</a>.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="changes">Changes<a href="#changes" class="hash-link" aria-label="Direct link to Changes" title="Direct link to Changes">​</a></h2>
<p>42 commits, 6905 lines added, 601 lines deleted, that&#x27;s the size of the changes since <a href="/blog/the-beginning">The Beginning</a>.</p>
<p>I&#x27;m very proud of how things are going, I learned a lot by studying to implement these new things.</p>
<p>But, let&#x27;s learn what&#x27;s new in all these releases.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="azure-and-firebase">Azure and Firebase<a href="#azure-and-firebase" class="hash-link" aria-label="Direct link to Azure and Firebase" title="Direct link to Azure and Firebase">​</a></h2>
<p>You can now use this library to deploy your apps to <a href="https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-vs-code-node" target="_blank" rel="noopener noreferrer">Azure Functions</a>
and <a href="https://firebase.google.com/docs/functions/http-events" target="_blank" rel="noopener noreferrer">Firebase Functions</a>.</p>
<p>More specifically, you can integrate with Http Trigger V4 on Azure and Http Events on Firebase.</p>
<p>These integrations are just to open the door of possibilities, in the future I want to add support for more triggers in these clouds.</p>
<p>Check out the <a href="/docs/main/handlers/azure">Azure</a> and <a href="/docs/main/handlers/firebase">Firebase</a> docs for how to integrate.</p>
<p>I also added examples for the cloud in the <a href="https://github.com/H4ad/serverless-adapter-examples" target="_blank" rel="noopener noreferrer">serverless-adapter-examples</a> repository.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trpc">tRPC<a href="#trpc" class="hash-link" aria-label="Direct link to tRPC" title="Direct link to tRPC">​</a></h2>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate"><a href="https://trpc.io/docs/" target="_blank" rel="noopener">https://trpc.io/docs/</a></div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><p>tRPC allows you to easily build &amp; consume fully typesafe APIs, without schemas or code generation.</p></div></div>
<p>tRPC is a framework that brings a new way of thinking about APIs, instead of REST or GraphQL, you can build typesafe APIs and easily
can integrate with the client, seems to be very promising.</p>
<p>So now you can deploy applications developed with tRPC to any cloud that this library supports, have a look at <a href="/docs/main/frameworks/trpc">docs</a>
to learn more about how to use it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="thats-all-folks">That&#x27;s all folks!<a href="#thats-all-folks" class="hash-link" aria-label="Direct link to That&#x27;s all folks!" title="Direct link to That&#x27;s all folks!">​</a></h2>
<p>I have two more weeks to work in this library without worrying because I&#x27;m on vacation at the university,
so probably my next efforts will be to bring more articles to this blog to show the full power of this library.</p>
<p>Giving some spoilers for those of you that make it this far, I&#x27;ll start by showing you the benefits of using AWS Lambda integrated with
API Gateway and SQS, I used it in a project of my company and I managed to reduce a lot of stress on the database and now
we are able to process 500k votes in minutes without spending 15% CPU using a PostgreSQL database on a t2.micro instance.</p>
<p>That&#x27;s all for today, thank you!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/serverless-adapter">serverless-adapter</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/trpc">trpc</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure">azure</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/firebase">firebase</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Hello, welcome to my new library to help you integrate your API with the serverless world."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/the-beginning">The Beginning</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-06-17T00:00:00.000Z" itemprop="datePublished">June 17, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/h4ad" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/h4ad.png" alt="Vinícius Lourenço" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/h4ad" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Vinícius Lourenço</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Serverless Adapter</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Hello, welcome to my new library to help you integrate your API with the serverless world.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-development">The development<a href="#the-development" class="hash-link" aria-label="Direct link to The development" title="Direct link to The development">​</a></h2>
<p>It took me almost 5 months to build this library, refactoring was easy and testing was challenging, but documenting this library was the hardest part.</p>
<p>It took me almost 2 weeks to refactor <a href="https://github.com/vendia/serverless-express" target="_blank" rel="noopener noreferrer">@vendia/serverless-express</a>,
about 1 and a half month to create tests with 99% coverage and the rest of the time I spent creating documentation for this library.</p>
<p>I currently added support for:</p>
<ul>
<li>AWS<!-- -->
<ul>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/services-alb.html" target="_blank" rel="noopener noreferrer">AWS Load Balancer</a> by using (<a href="/docs/main/adapters/aws/alb">AlbAdapter</a>)</li>
<li><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-lambda.html" target="_blank" rel="noopener noreferrer">AWS Api Gateway V1</a> by using (<a href="/docs/main/adapters/aws/api-gateway-v1">ApiGatewayV1Adapter</a>)</li>
<li><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-lambda.html" target="_blank" rel="noopener noreferrer">AWS Api Gateway V2</a> by using (<a href="/docs/main/adapters/aws/api-gateway-v2">ApiGatewayV2Adapter</a>)</li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/with-ddb.html" target="_blank" rel="noopener noreferrer">AWS DynamoDB</a> by using (<a href="/docs/main/adapters/aws/dynamodb">DynamoDBAdapter</a>)</li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/services-cloudwatchevents.html" target="_blank" rel="noopener noreferrer">AWS Event Bridge / CloudWatch Events</a> by using (<a href="/docs/main/adapters/aws/event-bridge">EventBridgeAdapter</a>)</li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-edge.html" target="_blank" rel="noopener noreferrer">AWS Lambda Edge</a> by using (<a href="/docs/main/adapters/aws/lambda-edge">LambdaEdgeAdapter</a>)</li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/with-sns.html" target="_blank" rel="noopener noreferrer">AWS SNS</a> by using (<a href="/docs/main/adapters/aws/sns">SNSAdapter</a>)</li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/with-sqs.html" target="_blank" rel="noopener noreferrer">AWS SQS</a> by using (<a href="/docs/main/adapters/aws/sqs">SQSAdapter</a>)</li>
</ul>
</li>
<li>Huawei<!-- -->
<ul>
<li><a href="https://support.huaweicloud.com/intl/en-us/usermanual-functiongraph/functiongraph_01_1442.html" target="_blank" rel="noopener noreferrer">Http Function</a>: Look <a href="/docs/main/handlers/huawei#http-function">this section</a>.</li>
<li><a href="https://support.huaweicloud.com/intl/en-us/usermanual-functiongraph/functiongraph_01_1441.html" target="_blank" rel="noopener noreferrer">Event Function</a>: Look <a href="/docs/main/handlers/huawei#event-function">this section</a>.<!-- -->
<ul>
<li><a href="https://support.huaweicloud.com/intl/en-us/devg-functiongraph/functiongraph_02_0102.html#functiongraph_02_0102__li5178638110137" target="_blank" rel="noopener noreferrer">Api Gateway</a> by using (<a href="/docs/main/adapters/huawei/huawei-api-gateway">HuaweiApiGatewayAdapter</a>).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>But it&#x27;s just the beginning, I&#x27;m going to build more adapters to integrate with as much of the cloud as possible, just to be able to deploy my APIs on any cloud.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-me">About me<a href="#about-me" class="hash-link" aria-label="Direct link to About me" title="Direct link to About me">​</a></h2>
<p>I am a student at <a href="https://facens.br/" target="_blank" rel="noopener noreferrer">Facens</a> university and I work for <a href="https://liga.facens.br/" target="_blank" rel="noopener noreferrer">Liga</a>, which is a sector within Facens that develops applications, websites, games and much more fun stuff.</p>
<p>I currently work on this library only in my spare time and I need to balance my Final Theses and my overtime projects so it was very challenging but I am happy with the end result of this library.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="inspiration">Inspiration<a href="#inspiration" class="hash-link" aria-label="Direct link to Inspiration" title="Direct link to Inspiration">​</a></h2>
<p>This library was originally created to help my company reduce costs with AWS SQS, but it has since turned into something I can spend my time developing and learning English because I&#x27;m not a native speaker (as typing problems might suggest) writing all the documentation in English.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="credits">Credits<a href="#credits" class="hash-link" aria-label="Direct link to Credits" title="Direct link to Credits">​</a></h2>
<p>I need to thank <a href="https://vendia.net/" target="_blank" rel="noopener noreferrer">@vendia</a> for developing <a href="https://github.com/vendia/serverless-express" target="_blank" rel="noopener noreferrer">@vendia/serverless-express</a>, all logic and code I finished to refactor from the code I read on serverless-express.
I also have many thanks to <a href="https://github.com/guichaguri" target="_blank" rel="noopener noreferrer">Chaguri</a>, <a href="https://liga.facens.br/" target="_blank" rel="noopener noreferrer">Liga</a> and many other people who gave me time and insights to create this library.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="you-can-use-it-right-now">You can use it right now!<a href="#you-can-use-it-right-now" class="hash-link" aria-label="Direct link to You can use it right now!" title="Direct link to You can use it right now!">​</a></h2>
<p>See the <a href="/docs/main/intro">Introduction</a> section to know more about the library.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/serverless-adapter">serverless-adapter</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About Maintainer</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/vinii_joga10" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/vinilourenco/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/h4ad/serverless-adapter" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://liga.facens.br/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LIGA</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Serverless Adapter. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>